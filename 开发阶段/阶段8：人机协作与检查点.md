## é˜¶æ®µå…«ï¼šäººæœºåä½œä¸æ£€æŸ¥ç‚¹ (1å‘¨)

> **ç›®æ ‡**ï¼šå®ç°ç”¨æˆ·æ£€æŸ¥ç‚¹æœºåˆ¶ã€å»ºè®®é€‰é¡¹ã€è¡ŒåŠ¨å¤„ç†ã€æ’¤å›å¿«ç…§ï¼Œå®Œæˆäººæœºåä½œé—­ç¯

> **âš ï¸ æ ¸å¿ƒæ¶æ„ï¼šçº¿æ€§æ’¤å› + WAL æ¢å¤æ—¥å¿—**ï¼š
> - **SnapshotService**ï¼šç®¡ç†çº¿æ€§å¿«ç…§æ ˆï¼Œæ’¤å›æ—¶æ¢å¤æ–‡ä»¶
> - **RecoveryLogService**ï¼šWAL æ—¥å¿—ä¿éšœå´©æºƒæ¢å¤
> - **GraphState é‡å»º**ï¼šæ’¤å›åé€šè¿‡ `initialize_project` ä»ç£ç›˜æ–‡ä»¶é‡å»º
> - **ç®€åŒ–è®¾è®¡**ï¼šæ”¾å¼ƒ LangGraph Time Travel åˆ†æ”¯æœºåˆ¶ï¼Œé¿å…æ£€æŸ¥ç‚¹å†å²åˆ†å‰

> **âš ï¸ æœ¬é˜¶æ®µç»Ÿä¸€ç®¡ç†æç¤º**ï¼š
> - æ£€æŸ¥ç‚¹é€šè¿‡ SnapshotService åˆ›å»ºæ–‡ä»¶å¿«ç…§
> - æ’¤å›é€šè¿‡ SnapshotService.restore_snapshot() + GraphState é‡å»ºå®ç°
> - å´©æºƒæ¢å¤é€šè¿‡ RecoveryLogService çš„ WAL æ—¥å¿—å®ç°
> - æ‰€æœ‰é”™è¯¯é€šè¿‡ ErrorHandler ç»Ÿä¸€å¤„ç†å’Œç”¨æˆ·æç¤º
> - æ–°å¢ UI ç»„ä»¶éœ€å®ç° `retranslate_ui()` æ–¹æ³•

> **âš ï¸ è·¨é˜¶æ®µä¾èµ–æ£€æŸ¥**ï¼š
> - å¼€å§‹æœ¬é˜¶æ®µå‰ï¼Œå¿…é¡»ç¡®è®¤ä»¥ä¸‹æ¨¡å—å·²æ­£ç¡®å®ç°ï¼š
>   - `domain/services/snapshot_service.py` - å…¨é‡å¿«ç…§æœåŠ¡ï¼ˆé˜¶æ®µ 2.5ï¼‰
>   - `domain/services/recovery_log_service.py` - WAL æ¢å¤æ—¥å¿—æœåŠ¡ï¼ˆé˜¶æ®µ 2.5ï¼‰
>   - `domain/services/design_service.py` - è®¾è®¡ç›®æ ‡æœåŠ¡ï¼ˆé˜¶æ®µ 2.5ï¼‰
>   - `domain/services/iteration_history_service.py` - è¿­ä»£å†å²è§†å›¾æœåŠ¡ï¼ˆé˜¶æ®µ 2.5ï¼‰
>   - `domain/services/simulation_service.py` - ä»¿çœŸæ‰§è¡ŒæœåŠ¡ï¼ˆé˜¶æ®µå››ï¼‰
>   - `domain/services/context_service.py` - å¯¹è¯å†å²æœåŠ¡ï¼ˆé˜¶æ®µä¸‰ï¼‰
>   - `application/graph/state.py` - GraphState å®šä¹‰ï¼ˆé˜¶æ®µä¸ƒï¼‰
>   - `application/graph/edges.py` - æ¡ä»¶è¾¹è·¯ç”±ï¼ˆé˜¶æ®µä¸ƒï¼‰
>   - `application/tool_execution/tool_executor.py` - å·¥å…·æ‰§è¡Œæ¥å£ï¼ˆé˜¶æ®µå…­ï¼‰

---

### 8.0 ç»Ÿä¸€å¯¹è¯å…¥å£è®¾è®¡

> **è®¾è®¡ç›®æ ‡**ï¼šåœ¨æ¯è½®è¿­ä»£å®Œæˆåï¼Œç³»ç»Ÿæš‚åœå¹¶æ˜¾ç¤ºæ™ºèƒ½å»ºè®®é€‰é¡¹ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©é¢„è®¾é€‰é¡¹æˆ–è‡ªç”±è¾“å…¥ã€‚ç»Ÿä¸€çš„å¯¹è¯å…¥å£ç¡®ä¿ç”¨æˆ·ä½“éªŒä¸€è‡´ã€‚

- [ ] **æ ¸å¿ƒåŸåˆ™**ï¼š
  - æ— è®ºæ˜¯åœ¨æ£€æŸ¥ç‚¹ä¸­è¿˜æ˜¯è®¾è®¡å¼€å§‹ä¹‹å‰ï¼Œç”¨æˆ·ä¸ AI å¯¹è¯çš„å…¥å£å§‹ç»ˆåªæœ‰ä¸€ä¸ªï¼ˆå¯¹è¯é¢æ¿çš„è¾“å…¥æ¡†ï¼‰
  - ä¸ä¼šå‡ºç°å¤šä¸ªå¯¹è¯æ æˆ–é¢å¤–çš„è¾“å…¥åŒºåŸŸ
  - æ£€æŸ¥ç‚¹æ—¶å»ºè®®é€‰é¡¹ä½œä¸ºä¸€æ¡ç‰¹æ®Šæ¶ˆæ¯æ˜¾ç¤ºåœ¨å¯¹è¯å†å²åŒºï¼Œåƒæ­£å¸¸æ¶ˆæ¯ä¸€æ ·æŠŠä¸Šé¢çš„å†…å®¹å‘ä¸Šé¡¶
  - å»ºè®®é€‰é¡¹æ¶ˆæ¯ä»…ä¸ºå¿«æ·æ“ä½œï¼Œä¸æ˜¯ç‹¬ç«‹çš„äº¤äº’é€šé“
- [ ] **å»ºè®®é€‰é¡¹æ¶ˆæ¯è®¾è®¡**ï¼š
  - å»ºè®®é€‰é¡¹ä½œä¸ºä¸€æ¡ç‰¹æ®Šçš„ç³»ç»Ÿæ¶ˆæ¯è¿½åŠ åˆ°å¯¹è¯å†å²åŒºåº•éƒ¨
  - æ¶ˆæ¯åŒ…å«çŠ¶æ€æ‘˜è¦å’Œå»ºè®®æŒ‰é’®ç»„
  - ç”¨æˆ·ç‚¹å‡»æŒ‰é’®åï¼Œè¯¥æ¶ˆæ¯ä¿ç•™åœ¨å†å²ä¸­ï¼ŒæŒ‰é’®å˜ä¸ºå·²é€‰æ‹©çŠ¶æ€ï¼ˆç¦ç”¨ï¼‰
  - ç”¨æˆ·é€šè¿‡è¾“å…¥æ¡†å‘é€æ¶ˆæ¯åï¼Œè¯¥æ¶ˆæ¯çš„æŒ‰é’®å˜ä¸ºè¿‡æœŸçŠ¶æ€ï¼ˆç¦ç”¨ä½†ä¸æ˜¾ç¤ºé€‰ä¸­æ ‡è®°ï¼‰
  - ä¾¿äºç”¨æˆ·å›é¡¾æ¯è½®è¿­ä»£çš„æ“ä½œé€‰æ‹©
- [ ] **äº¤äº’æµç¨‹**ï¼š
  1. ç”¨æˆ·åœ¨å¯¹è¯é¢æ¿è¾“å…¥æ¶ˆæ¯æˆ–ç‚¹å‡»å»ºè®®æ¶ˆæ¯ä¸­çš„æŒ‰é’®
  2. ç³»ç»Ÿç»Ÿä¸€é€šè¿‡ `design_workflow.handle_user_input()` å¤„ç†
  3. æŒ‰é’®ç‚¹å‡»ï¼šç›´æ¥è·¯ç”±åˆ°å¯¹åº”çš„é¢„è®¾è¡ŒåŠ¨å¤„ç†å™¨
  4. è‡ªç”±è¾“å…¥ï¼šç»Ÿä¸€è¿›å…¥ `action_node`ï¼Œç”± LLM è‡ªè¡Œå†³å®šå›ç­”é—®é¢˜ã€è°ƒç”¨å·¥å…·æˆ–ä¸¤è€…å…¼é¡¾

---

### 8.1 æ£€æŸ¥ç‚¹å»ºè®®é€‰é¡¹

> **æ¶‰åŠæ–‡ä»¶**ï¼š
> - `application/graph/nodes/checkpoint/suggestion_generator.py` - å»ºè®®é€‰é¡¹ç”Ÿæˆé€»è¾‘
> - `presentation/panels/conversation/suggestion_message.py` - å»ºè®®é€‰é¡¹æ¶ˆæ¯ UI ç»„ä»¶

#### 8.1.1 å»ºè®®é€‰é¡¹è¯¦è§£

- [ ] **ç»§ç»­ä¼˜åŒ–**ï¼ˆID: `optimize`ï¼‰ï¼š
  - æ˜¾ç¤ºæ¡ä»¶ï¼šå§‹ç»ˆæ˜¾ç¤º
  - æ‰§è¡Œé€»è¾‘ï¼šå°†å½“å‰æ€§èƒ½æŒ‡æ ‡ã€å·®è·åˆ†æã€ä¼˜åŒ–å»ºè®®æ³¨å…¥ Promptï¼ŒLLM ç”Ÿæˆå‚æ•°è°ƒæ•´æ–¹æ¡ˆ
  - å®ç°è¦ç‚¹ï¼š`action_node` è·¯ç”±åˆ° `OptimizeAction` å¤„ç†å™¨ï¼Œä½¿ç”¨ `OPTIMIZE_PARAMETERS` æ¨¡æ¿
  - åç»­æµç¨‹ï¼šæ‰§è¡Œæ–‡ä»¶ä¿®æ”¹åè¿›å…¥ `simulation_node` éªŒè¯æ•ˆæœ

- [ ] **ä¿®å¤é”™è¯¯**ï¼ˆID: `fix_error`ï¼‰ï¼š
  - æ˜¾ç¤ºæ¡ä»¶ï¼š`simulation_success = False` æ—¶æ˜¾ç¤º
  - æ‰§è¡Œé€»è¾‘ï¼šç›´æ¥ä» `GraphState.last_simulation_error` è¯»å–å·²æœ‰é”™è¯¯ä¿¡æ¯ï¼Œæ„å»ºé”™è¯¯ä¸Šä¸‹æ–‡æ³¨å…¥ Promptï¼ŒLLM åˆ†æå¹¶ä¿®å¤
  - å®ç°è¦ç‚¹ï¼š`action_node` è·¯ç”±åˆ° `FixErrorAction` å¤„ç†å™¨ï¼Œä½¿ç”¨ `ErrorContextBuilder` æ„å»ºä¸Šä¸‹æ–‡ï¼Œä½¿ç”¨ `FIX_ERROR` æ¨¡æ¿
  - åç»­æµç¨‹ï¼šæ‰§è¡Œæ–‡ä»¶ä¿®æ”¹åè¿›å…¥ `simulation_node` éªŒè¯ä¿®å¤ç»“æœ
  - è®¾è®¡åŸåˆ™ï¼šä¸é‡å¤è¿è¡Œä»¿çœŸï¼Œå¤ç”¨ `simulation_node` å·²æ”¶é›†çš„é”™è¯¯ä¿¡æ¯ï¼Œé¿å…å»¶è¿Ÿå’Œæ•°æ®ä¸ä¸€è‡´

- [ ] **ä¿®æ”¹ç›®æ ‡**ï¼ˆID: `modify_goals`ï¼‰ï¼š
  - æ˜¾ç¤ºæ¡ä»¶ï¼šå§‹ç»ˆæ˜¾ç¤º
  - æ‰§è¡Œé€»è¾‘ï¼šå¼¹å‡ºè®¾è®¡ç›®æ ‡ç¼–è¾‘å¯¹è¯æ¡†ï¼Œç”¨æˆ·å¯æ‰‹åŠ¨æŸ¥çœ‹å’Œä¿®æ”¹å½“å‰å­˜å‚¨çš„è®¾è®¡ç›®æ ‡
  - å®ç°è¦ç‚¹ï¼š
    - ç‚¹å‡»æŒ‰é’®åå¼¹å‡º `DesignGoalsEditDialog` å¯¹è¯æ¡†
    - å¯¹è¯æ¡†åŠ è½½å½“å‰ `GraphState.design_goals` çš„å†…å®¹
    - ç”¨æˆ·å¯ç¼–è¾‘å„é¡¹æŒ‡æ ‡çš„ç›®æ ‡å€¼ã€ä¼˜å…ˆçº§ã€å®¹å·®èŒƒå›´ç­‰
    - ç”¨æˆ·ç¡®è®¤åæ›´æ–° `GraphState.design_goals` å¹¶åŒæ­¥åˆ° JSON å‰¯æœ¬
    - é‡ç½® `checkpoint_count`ï¼Œä» `initial_design_node` é‡æ–°å¼€å§‹è®¾è®¡
  - åç»­æµç¨‹ï¼šç”¨æˆ·ç¡®è®¤ä¿®æ”¹åè¿›å…¥ `initial_design_node` é‡æ–°è®¾è®¡

- [ ] **æ¥å—è®¾è®¡**ï¼ˆID: `accept`ï¼‰ï¼š
  - æ˜¾ç¤ºæ¡ä»¶ï¼š`performance_score >= threshold` æˆ–ç”¨æˆ·å¼ºåˆ¶é€‰æ‹©
  - æ‰§è¡Œé€»è¾‘ï¼šä¿å­˜æ‰€æœ‰å·²ä¿®æ”¹æ–‡ä»¶ï¼Œç”Ÿæˆ PDF è®¾è®¡æŠ¥å‘Šï¼Œæ ‡è®°è®¾è®¡å®Œæˆ
  - å®ç°è¦ç‚¹ï¼š`accept_node` è°ƒç”¨ `file_manager.save_all()` å’Œ `report_generator.generate_report()`
  - åç»­æµç¨‹ï¼šå‘å¸ƒ `EVENT_DESIGN_COMPLETED` äº‹ä»¶ï¼Œæµç¨‹ç»“æŸ

- [ ] **åœæ­¢è®¾è®¡**ï¼ˆID: `stop`ï¼‰ï¼š
  - æ˜¾ç¤ºæ¡ä»¶ï¼šå§‹ç»ˆæ˜¾ç¤º
  - æ‰§è¡Œé€»è¾‘ï¼šä¸ä¿å­˜å½“å‰ä¿®æ”¹ï¼Œç›´æ¥ç»ˆæ­¢æµç¨‹ï¼Œä¿ç•™ä¸Šä¸€ä¸ªæ£€æŸ¥ç‚¹çš„çŠ¶æ€
  - å®ç°è¦ç‚¹ï¼šç›´æ¥è·¯ç”±åˆ° `END`ï¼Œä¸æ‰§è¡Œä»»ä½•ä¿å­˜æ“ä½œ
  - åç»­æµç¨‹ï¼šå‘å¸ƒ `EVENT_DESIGN_STOPPED` äº‹ä»¶ï¼Œæµç¨‹ç»“æŸ

- [ ] **æ’¤å›**ï¼ˆID: `undo`ï¼‰ï¼š
  - æ˜¾ç¤ºæ¡ä»¶ï¼šå§‹ç»ˆæ˜¾ç¤ºï¼ˆç¬¬ä¸€æ¬¡è¿­ä»£æ—¶å¯ç¦ç”¨æˆ–æç¤ºæ— å¯æ’¤å›å†…å®¹ï¼‰
  - æ‰§è¡Œé€»è¾‘ï¼šæ¢å¤åˆ°ä¸Šä¸€ä¸ªè¿­ä»£æ£€æŸ¥ç‚¹çš„å®Œæ•´çŠ¶æ€ï¼ˆæ–‡ä»¶ã€GraphStateï¼‰
  - å®ç°è¦ç‚¹ï¼š`undo_node` è°ƒç”¨ `undo_manager.restore_snapshot()`
  - åç»­æµç¨‹ï¼šæ¢å¤å®Œæˆåè¿”å› `user_checkpoint_node` ç»§ç»­ç­‰å¾…ç”¨æˆ·é€‰æ‹©

#### 8.1.2 å»ºè®®é€‰é¡¹æ•°æ®ç»“æ„

- [ ] **å»ºè®®é€‰é¡¹ç»“æ„**ï¼š
  ```python
  {
    "id": str,              # é€‰é¡¹æ ‡è¯†ï¼ˆoptimize/fix_error/modify_goals/accept/stop/undoï¼‰
    "label": str,           # æ˜¾ç¤ºæ–‡æœ¬
    "description": str,     # æè¿°è¯´æ˜
    "is_primary": bool,     # æ˜¯å¦ä¸ºä¸»è¦å»ºè®®ï¼ˆé«˜äº®æ˜¾ç¤ºï¼‰
    "is_enabled": bool,     # æ˜¯å¦å¯ç”¨
    "style": str,           # æ ·å¼ç±»å‹ï¼ˆprimary/warning/success/danger/defaultï¼‰
  }
  ```



---

### 8.2 è‡ªç”±è¾“å…¥å¤„ç†æœºåˆ¶

> **è®¾è®¡ç†å¿µ**ï¼šç°ä»£å¤§æ¨¡å‹ï¼ˆGPT-4ã€GLM-4 ç­‰ï¼‰å·²å…·å¤‡è¶³å¤Ÿçš„è¯­ä¹‰ç†è§£èƒ½åŠ›ï¼Œå¯ä»¥åœ¨å•æ¬¡è°ƒç”¨ä¸­åŒæ—¶å›ç­”é—®é¢˜å¹¶æ‰§è¡Œæ“ä½œã€‚æ— éœ€é¢„å…ˆè¿›è¡Œæ„å›¾åˆ†ç±»ï¼Œç›´æ¥è®© LLM æ ¹æ®ç”¨æˆ·è¾“å…¥è‡ªè¡Œå†³å®šå“åº”æ–¹å¼ã€‚

> **æ¶‰åŠæ–‡ä»¶**ï¼š
> - `application/graph/nodes/action_node.py` - ç»Ÿä¸€å¤„ç†ç”¨æˆ·è¾“å…¥
> - `resources/prompts/task_prompts.json` - æ·»åŠ  `FREE_INPUT_RESPONSE` æ¨¡æ¿

#### 8.2.1 ç»Ÿä¸€å¤„ç†æµç¨‹

- [ ] **å¤„ç†æ—¶æœº**ï¼šç”¨æˆ·åœ¨æ£€æŸ¥ç‚¹è‡ªç”±è¾“å…¥æ¶ˆæ¯ï¼ˆè€Œéç‚¹å‡»å»ºè®®æŒ‰é’®ï¼‰æ—¶
- [ ] **å¤„ç†æ–¹å¼**ï¼šç»Ÿä¸€è¿›å…¥ `action_node`ï¼Œç”± LLM è‡ªè¡Œå†³å®šå“åº”æ–¹å¼
  - LLM å¯ä»¥ä»…å›ç­”é—®é¢˜ï¼ˆä¸è°ƒç”¨å·¥å…·ï¼‰
  - LLM å¯ä»¥ä»…æ‰§è¡Œæ“ä½œï¼ˆè°ƒç”¨å·¥å…·ä¿®æ”¹æ–‡ä»¶ï¼‰
  - LLM å¯ä»¥å…ˆå›ç­”é—®é¢˜å†æ‰§è¡Œæ“ä½œï¼ˆä¸¤è€…å…¼é¡¾ï¼‰
- [ ] **è®¾è®¡ä¼˜åŠ¿**ï¼š
  - å‡å°‘ä¸€æ¬¡ LLM è°ƒç”¨ï¼Œé™ä½å»¶è¿Ÿå’Œæˆæœ¬
  - é¿å…æ„å›¾åˆ†ç±»é”™è¯¯å¯¼è‡´çš„è·¯ç”±é—®é¢˜
  - æ›´ç¬¦åˆç°ä»£ AI åŠ©æ‰‹çš„è‡ªç„¶äº¤äº’æ¨¡å¼
  - æ¶æ„æ›´ç®€æ´ï¼Œç»´æŠ¤æˆæœ¬æ›´ä½

#### 8.2.2 LLM å“åº”è¡Œä¸º

- [ ] **çº¯é—®é¢˜åœºæ™¯**ï¼š
  - ç”¨æˆ·è¾“å…¥ï¼š"ä¸ºä»€ä¹ˆå¢ç›Šæ²¡æœ‰è¾¾åˆ°ç›®æ ‡ï¼Ÿ"
  - LLM å›ç­”é—®é¢˜ï¼Œä¸è°ƒç”¨ä»»ä½•å·¥å…·
  - å›ç­”å®Œæˆåè¿”å›æ£€æŸ¥ç‚¹ï¼Œç­‰å¾…ç”¨æˆ·ä¸‹ä¸€æ­¥é€‰æ‹©
- [ ] **çº¯æŒ‡ä»¤åœºæ™¯**ï¼š
  - ç”¨æˆ·è¾“å…¥ï¼š"æŠŠ R1 çš„é˜»å€¼æ”¹æˆ 15K"
  - LLM è°ƒç”¨ `patch_file` å·¥å…·æ‰§è¡Œä¿®æ”¹
  - ä¿®æ”¹å®Œæˆåè¿›å…¥ `simulation_node` éªŒè¯æ•ˆæœ
- [ ] **æ··åˆåœºæ™¯**ï¼š
  - ç”¨æˆ·è¾“å…¥ï¼š"å¢ç›Šä¸ºä»€ä¹ˆä¸å¤Ÿï¼Ÿå¸®æˆ‘è°ƒå¤§ä¸€ç‚¹"
  - LLM å…ˆå›ç­”å¢ç›Šä¸è¶³çš„åŸå› ï¼Œå†è°ƒç”¨å·¥å…·è°ƒæ•´å‚æ•°
  - ä¿®æ”¹å®Œæˆåè¿›å…¥ `simulation_node` éªŒè¯æ•ˆæœ
- [ ] **æ¨¡ç³Šåœºæ™¯**ï¼š
  - ç”¨æˆ·è¾“å…¥ä¸æ˜ç¡®æ—¶ï¼ŒLLM å¯ä¸»åŠ¨è¯¢é—®æ¾„æ¸…
  - ä¾‹å¦‚ï¼š"æ‚¨å¸Œæœ›æˆ‘è°ƒæ•´å“ªä¸ªå‚æ•°ï¼Ÿæˆ–è€…æ‚¨åªæ˜¯æƒ³äº†è§£ä¸€äº›ä¿¡æ¯ï¼Ÿ"

#### 8.2.3 åç»­æµç¨‹åˆ¤æ–­

- [ ] **åˆ¤æ–­ä¾æ®**ï¼šæ ¹æ® LLM æ˜¯å¦è°ƒç”¨äº†æ–‡ä»¶ä¿®æ”¹å·¥å…·
  - è°ƒç”¨äº†æ–‡ä»¶ä¿®æ”¹å·¥å…· â†’ è¿›å…¥ `simulation_node` éªŒè¯ä¿®æ”¹æ•ˆæœ
  - æœªè°ƒç”¨æ–‡ä»¶ä¿®æ”¹å·¥å…· â†’ è¿”å› `user_checkpoint_node` ç»§ç»­ç­‰å¾…ç”¨æˆ·é€‰æ‹©
- [ ] **æ–‡ä»¶ä¿®æ”¹å·¥å…·åˆ—è¡¨**ï¼š
  - `rewrite_file`ã€`patch_file`
- [ ] **å®ç°æ–¹å¼**ï¼š
  - `action_node` æ‰§è¡Œå®Œæˆåæ£€æŸ¥ `tool_calls` åˆ—è¡¨
  - è‹¥åŒ…å«æ–‡ä»¶ä¿®æ”¹å·¥å…· â†’ è®¾ç½® `next_node = "simulation_node"`
  - è‹¥ä¸åŒ…å« â†’ è®¾ç½® `next_node = "user_checkpoint_node"`

---

### 8.3 ä»¿çœŸé”™è¯¯å¤„ç†æœºåˆ¶

> **æ¶‰åŠæ–‡ä»¶**ï¼š
> - `application/graph/nodes/simulation_node.py` - é”™è¯¯æ£€æµ‹å’ŒçŠ¶æ€æ›´æ–°
> - `domain/llm/context_retrieval/diagnostics_collector.py` - é”™è¯¯ä¿¡æ¯æ³¨å…¥ Prompt
> - `shared/error_handler.py` - é”™è¯¯è§£ææ–¹æ³•

#### 8.3.1 é”™è¯¯ä¿¡æ¯æ”¶é›†

- [ ] **æ”¶é›†æ—¶æœº**ï¼š
  - `simulation_node` æ‰§è¡Œä»¿çœŸåæ£€æµ‹åˆ°é”™è¯¯
  - ngspice è¿”å›éé›¶é€€å‡ºç æˆ–è¾“å‡ºåŒ…å«é”™è¯¯å…³é”®è¯
- [ ] **æ”¶é›†å†…å®¹**ï¼š
  - é”™è¯¯ç±»å‹ï¼ˆè¯­æ³•é”™è¯¯ã€æ”¶æ•›å¤±è´¥ã€æ¨¡å‹ç¼ºå¤±ã€èŠ‚ç‚¹æµ®ç©ºç­‰ï¼‰
  - é”™è¯¯ä½ç½®ï¼ˆæ–‡ä»¶åã€è¡Œå·ï¼Œå¦‚æœå¯è¯†åˆ«ï¼‰
  - åŸå§‹é”™è¯¯ä¿¡æ¯ï¼ˆngspice è¾“å‡ºçš„å…³é”®é”™è¯¯è¡Œï¼‰
  - é”™è¯¯ä¸Šä¸‹æ–‡ï¼ˆé”™è¯¯è¡Œå‰åå„ 3 è¡Œä»£ç ï¼‰
- [ ] **å­˜å‚¨ä½ç½®**ï¼š
  - `GraphState.last_simulation_error` - æœ€è¿‘ä¸€æ¬¡ä»¿çœŸé”™è¯¯ä¿¡æ¯
  - ç»“æ„ï¼š`{"type": str, "message": str, "file": str, "line": int, "context": str}`

#### 8.3.2 é”™è¯¯å¤„ç†æµç¨‹

- [ ] **é”™è¯¯æ£€æµ‹åçš„æµç¨‹**ï¼š
  1. `simulation_node` æ£€æµ‹åˆ°ä»¿çœŸé”™è¯¯
  2. è°ƒç”¨ `error_handler.parse_simulation_error()` è§£æé”™è¯¯ç±»å‹
  3. å°†é”™è¯¯ä¿¡æ¯å†™å…¥ `GraphState.last_simulation_error`
  4. è®¾ç½® `GraphState.simulation_success = False`
  5. å·¥ä½œæµè¿›å…¥ `user_checkpoint_node`
  6. å‘å¸ƒ `EVENT_ITERATION_AWAITING_CONFIRMATION` äº‹ä»¶
  7. UI æ˜¾ç¤ºä»¿çœŸé”™è¯¯ä¿¡æ¯å’Œ"ä¿®å¤é”™è¯¯"æŒ‰é’®ï¼ˆé«˜äº®æ˜¾ç¤ºï¼‰
- [ ] **ç”¨æˆ·ç‚¹å‡»"ä¿®å¤é”™è¯¯"å**ï¼š
  1. å·¥ä½œæµæ¢å¤æ‰§è¡Œï¼Œè¿›å…¥ `action_node`
  2. `action_node` è·¯ç”±åˆ° `FixErrorAction` å¤„ç†å™¨
  3. `FixErrorAction` ä» `GraphState.last_simulation_error` è¯»å–å·²æœ‰é”™è¯¯ä¿¡æ¯
  4. `ErrorContextBuilder` æ„å»ºåŒ…å«é”™è¯¯è¯¦æƒ…å’Œä»£ç ä¸Šä¸‹æ–‡çš„ Prompt
  5. LLM åˆ†æé”™è¯¯åŸå› å¹¶ç”Ÿæˆä¿®å¤æ–¹æ¡ˆ
  6. æ‰§è¡Œæ–‡ä»¶ä¿®æ”¹åè¿›å…¥ `simulation_node` éªŒè¯ä¿®å¤ç»“æœ
- [ ] **UI é”™è¯¯å±•ç¤º**ï¼š
  - ä»¿çœŸç»“æœæ ‡ç­¾é¡µæ˜¾ç¤ºé”™è¯¯æ‘˜è¦
  - å¯¹è¯é¢æ¿æ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯
  - å»ºè®®é€‰é¡¹æ¶ˆæ¯ä¸­é«˜äº®æ˜¾ç¤º"ä¿®å¤é”™è¯¯"æŒ‰é’®
  - æç¤ºç”¨æˆ·ï¼š"ä»¿çœŸå¤±è´¥ï¼Œç‚¹å‡»'ä¿®å¤é”™è¯¯'è®© AI åˆ†æå¹¶ä¿®å¤"

#### 8.3.3 é”™è¯¯ä¿¡æ¯æ³¨å…¥ Prompt

- [ ] **æ³¨å…¥ä½ç½®**ï¼š
  - åœ¨ `context_retrieval/diagnostics_collector.py` çš„ `collect()` æ–¹æ³•ä¸­
  - æ£€æŸ¥ `GraphState.last_simulation_error` æ˜¯å¦å­˜åœ¨
  - å­˜åœ¨æ—¶ï¼Œå¯å¤ç”¨ `ErrorContextBuilder` æ„å»ºé”™è¯¯ä¿¡æ¯æ®µè½
- [ ] **æ³¨å…¥æ ¼å¼**ï¼š
  ```markdown
  ## ä¸Šä¸€è½®ä»¿çœŸé”™è¯¯ï¼ˆéœ€ä¼˜å…ˆä¿®å¤ï¼‰
  
  é”™è¯¯ç±»å‹ï¼š{error_type}
  é”™è¯¯ä¿¡æ¯ï¼š{error_message}
  é”™è¯¯ä½ç½®ï¼š{file}:{line}
  
  é”™è¯¯ä¸Šä¸‹æ–‡ï¼š
  ```{context_code}```
  
  è¯·åœ¨æœ¬è½®ä¿®æ”¹ä¸­ä¼˜å…ˆä¿®å¤æ­¤é”™è¯¯ï¼Œç¡®ä¿ç”µè·¯èƒ½å¤Ÿæ­£å¸¸ä»¿çœŸã€‚
  ```
- [ ] **é”™è¯¯æ¸…é™¤æ—¶æœº**ï¼š
  - ä»¿çœŸæˆåŠŸåï¼Œæ¸…é™¤ `GraphState.last_simulation_error`
  - ç¡®ä¿æˆåŠŸåçš„è¿­ä»£ä¸å†æºå¸¦æ—§é”™è¯¯ä¿¡æ¯
- [ ] **ä¸ ErrorContextBuilder çš„å…³ç³»**ï¼š
  - `diagnostics_collector` å¯å¤ç”¨ `ErrorContextBuilder.format_error_summary()` æ–¹æ³•
  - ä¿æŒé”™è¯¯ä¿¡æ¯æ ¼å¼çš„ä¸€è‡´æ€§

#### 8.3.4 é”™è¯¯ä¿®å¤ç†”æ–­æœºåˆ¶

> **è®¾è®¡ç›®æ ‡**ï¼šé˜²æ­¢"è®¾è®¡â†’ä»¿çœŸâ†’å¤±è´¥â†’ä¿®å¤â†’ä»¿çœŸâ†’å¤±è´¥"å¤–å±‚å¾ªç¯é™·å…¥æ­»å¾ªç¯ï¼Œæä¾›æ˜ç¡®çš„é€€å‡ºè·¯å¾„

> **æ¶‰åŠæ–‡ä»¶**ï¼š
> - `application/graph/nodes/actions/fix_attempt_tracker.py` - ä¿®å¤å°è¯•è¿½è¸ªå™¨
> - `shared/error_types.py` - ç†”æ–­é˜ˆå€¼å¸¸é‡ï¼ˆ`MAX_CONSECUTIVE_FIX_ATTEMPTS`ï¼‰

##### 8.3.4.1 `fix_attempt_tracker.py` - ä¿®å¤å°è¯•è¿½è¸ªå™¨

- [ ] **æ–‡ä»¶è·¯å¾„**ï¼š`application/graph/nodes/actions/fix_attempt_tracker.py`
- [ ] **èŒè´£**ï¼šå•ä¸€èŒè´£ï¼Œä¸“é—¨è¿½è¸ªå’Œåˆ¤æ–­è¿ç»­ä¿®å¤å¤±è´¥æ¬¡æ•°
- [ ] **æ ¸å¿ƒåŠŸèƒ½**ï¼š
  - `increment(state) -> dict` - å¢åŠ è¿ç»­ä¿®å¤å°è¯•è®¡æ•°ï¼Œè¿”å› GraphState æ›´æ–°
  - `reset(state) -> dict` - é‡ç½®è®¡æ•°å™¨ï¼ˆä»¿çœŸæˆåŠŸæ—¶è°ƒç”¨ï¼‰ï¼Œè¿”å› GraphState æ›´æ–°
  - `is_circuit_breaker_triggered(state) -> bool` - åˆ¤æ–­æ˜¯å¦è§¦å‘ç†”æ–­
  - `get_remaining_attempts(state) -> int` - è·å–å‰©ä½™å°è¯•æ¬¡æ•°
- [ ] **ç†”æ–­é˜ˆå€¼**ï¼š
  - `MAX_CONSECUTIVE_FIX_ATTEMPTS = 3`ï¼ˆå®šä¹‰åœ¨ `shared/error_types.py`ï¼‰
  - å¯é€šè¿‡é…ç½®æ–‡ä»¶è¦†ç›–
- [ ] **è¢«è°ƒç”¨æ–¹**ï¼š
  - `FixErrorAction` - æ‰§è¡Œå‰æ£€æŸ¥ç†”æ–­çŠ¶æ€ï¼Œæ‰§è¡Œåå¢åŠ è®¡æ•°
  - `simulation_node` - ä»¿çœŸæˆåŠŸæ—¶é‡ç½®è®¡æ•°
  - `SuggestionGenerator` - ç”Ÿæˆå»ºè®®é€‰é¡¹æ—¶æ£€æŸ¥ç†”æ–­çŠ¶æ€

##### 8.3.4.2 ç†”æ–­è§¦å‘åçš„è¡Œä¸º

- [ ] **å»ºè®®é€‰é¡¹å˜åŒ–**ï¼š
  - "ä¿®å¤é”™è¯¯"æŒ‰é’®å˜ä¸ºç¦ç”¨çŠ¶æ€
  - "ä¿®æ”¹ç›®æ ‡"æŒ‰é’®é«˜äº®æ˜¾ç¤ºï¼ˆå»ºè®®ç”¨æˆ·é‡æ–°è¯„ä¼°è®¾è®¡ç›®æ ‡ï¼‰
  - "åœæ­¢è®¾è®¡"æŒ‰é’®ä¿æŒå¯ç”¨
  - çŠ¶æ€æ‘˜è¦æ˜¾ç¤ºç†”æ–­æç¤º
- [ ] **ç”¨æˆ·æç¤ºä¿¡æ¯**ï¼š
  - åœ¨å¯¹è¯é¢æ¿æ˜¾ç¤ºï¼š"è¿ç»­ä¿®å¤å¤±è´¥ {N} æ¬¡ï¼Œå»ºè®®æ£€æŸ¥ç”µè·¯æ‹“æ‰‘æˆ–ä¿®æ”¹è®¾è®¡ç›®æ ‡"
  - æç¤ºä¿¡æ¯åŒ…å«å¯èƒ½çš„åŸå› åˆ†æï¼ˆåŸºäºé”™è¯¯ç±»å‹ï¼‰
- [ ] **ç†”æ–­åçš„å¯é€‰æ“ä½œ**ï¼š
  - ä¿®æ”¹è®¾è®¡ç›®æ ‡ï¼šé‡æ–°è¯„ä¼°ç›®æ ‡æ˜¯å¦åˆç†
  - æ’¤å›åˆ°ä¸Šä¸€ä¸ªæˆåŠŸçš„æ£€æŸ¥ç‚¹
  - åœæ­¢è®¾è®¡ï¼šä¿ç•™å½“å‰çŠ¶æ€ä¾›æ‰‹åŠ¨åˆ†æ
  - è‡ªç”±è¾“å…¥ï¼šç”¨æˆ·å¯ä»¥æ‰‹åŠ¨æŒ‡å¯¼ LLM å°è¯•å…¶ä»–ä¿®å¤æ–¹æ¡ˆï¼ˆä¸å—ç†”æ–­é™åˆ¶ï¼‰

##### 8.3.4.3 è®¡æ•°å™¨é‡ç½®æ—¶æœº

- [ ] **é‡ç½®ä¸º 0 çš„åœºæ™¯**ï¼š
  - ä»¿çœŸæˆåŠŸï¼ˆ`simulation_success = True`ï¼‰
  - ç”¨æˆ·ç‚¹å‡»"ä¿®æ”¹ç›®æ ‡"å¹¶ç¡®è®¤
  - ç”¨æˆ·æ‰§è¡Œæ’¤å›æ“ä½œ
  - ç”¨æˆ·é€šè¿‡è‡ªç”±è¾“å…¥æˆåŠŸä¿®å¤ï¼ˆä»¿çœŸé€šè¿‡ï¼‰
- [ ] **ä¸é‡ç½®çš„åœºæ™¯**ï¼š
  - ç”¨æˆ·ä»…æŸ¥çœ‹é”™è¯¯ä¿¡æ¯
  - ç”¨æˆ·å–æ¶ˆä¿®å¤æ“ä½œ

---

### 8.4 è®¾è®¡ç›®æ ‡ç¼–è¾‘å¯¹è¯æ¡†

#### 8.4.1 `design_goals_edit_dialog.py` - è®¾è®¡ç›®æ ‡ç¼–è¾‘å¯¹è¯æ¡†

- [ ] **æ–‡ä»¶è·¯å¾„**ï¼š`presentation/dialogs/design_goals_edit_dialog.py`
- [ ] **èŒè´£**ï¼šæä¾›å¯è§†åŒ–ç•Œé¢è®©ç”¨æˆ·æŸ¥çœ‹å’Œç¼–è¾‘å½“å‰å­˜å‚¨çš„è®¾è®¡ç›®æ ‡
- [ ] **è§¦å‘æ–¹å¼**ï¼ˆä¸‰ç§å…¥å£ï¼ŒåŒä¸€ä¸ªå¯¹è¯æ¡†ï¼‰ï¼š
  - èœå•æ "è®¾è®¡"â†’"è®¾è®¡ç›®æ ‡"ï¼šéšæ—¶æŸ¥çœ‹å’Œç¼–è¾‘è®¾è®¡ç›®æ ‡
  - æ£€æŸ¥ç‚¹ç‚¹å‡»"ä¿®æ”¹ç›®æ ‡"æŒ‰é’®ï¼šä¿®æ”¹åé‡æ–°å¼€å§‹è®¾è®¡
  - `design_goals_node` æå–ç›®æ ‡åï¼šè®©ç”¨æˆ·ç¡®è®¤ LLM æå–çš„ç›®æ ‡
- [ ] **ç»Ÿä¸€å­˜å‚¨**ï¼š
  - æ— è®ºä»å“ªä¸ªå…¥å£æ‰“å¼€ï¼Œæ“ä½œçš„éƒ½æ˜¯åŒä¸€ä»½è®¾è®¡ç›®æ ‡æ•°æ®
  - æ•°æ®å­˜å‚¨åœ¨ `GraphState.design_goals` å’Œ `.circuit_ai/design_goals.json`
  - GraphState æ˜¯å”¯ä¸€çœŸç†æ¥æºï¼ŒJSON æ–‡ä»¶é€šè¿‡ `DesignService` åŒæ­¥
- [ ] **å¯¹è¯æ¡†æ¨¡å¼**ï¼š
  - ç¡®è®¤æ¨¡å¼ï¼ˆ`design_goals_node` è°ƒç”¨ï¼‰ï¼šæ ‡é¢˜æ˜¾ç¤º"ç¡®è®¤è®¾è®¡ç›®æ ‡"ï¼Œæç¤ºè¿™æ˜¯ LLM æå–çš„å»ºè®®
  - ç¼–è¾‘æ¨¡å¼ï¼ˆèœå•æˆ–æ£€æŸ¥ç‚¹è°ƒç”¨ï¼‰ï¼šæ ‡é¢˜æ˜¾ç¤º"ç¼–è¾‘è®¾è®¡ç›®æ ‡"

#### 8.4.2 å¯¹è¯æ¡†å¸ƒå±€

- [ ] **å¯¹è¯æ¡†æ•´ä½“å¸ƒå±€**ï¼š
  - æ ‡é¢˜æ ï¼šæ ¹æ®æ¨¡å¼æ˜¾ç¤ºä¸åŒæ ‡é¢˜
  - æç¤ºåŒºï¼ˆä»…ç¡®è®¤æ¨¡å¼ï¼‰ï¼šæ˜¾ç¤º"ä»¥ä¸‹æ˜¯ä»æ‚¨çš„éœ€æ±‚ä¸­æå–çš„è®¾è®¡ç›®æ ‡ï¼Œè¯·ç¡®è®¤æˆ–ä¿®æ”¹"
  - ç”µè·¯ç±»å‹å’Œæè¿°åŒºï¼šæ˜¾ç¤ºç”µè·¯ç±»å‹å’Œè®¾è®¡æè¿°
  - ç›®æ ‡åˆ—è¡¨åŒºï¼šä½¿ç”¨ `QTableWidget` æ˜¾ç¤ºæ‰€æœ‰è®¾è®¡ç›®æ ‡
  - æŒ‰é’®åŒºï¼šç¡®è®¤ã€å–æ¶ˆã€æ·»åŠ ç›®æ ‡
- [ ] **ç›®æ ‡åˆ—è¡¨é¡¹æ˜¾ç¤ºå†…å®¹**ï¼š
  - æŒ‡æ ‡åç§°ï¼ˆå¦‚"å¢ç›Š"ã€"å¸¦å®½"ã€"åŠŸè€—"ï¼‰
  - ç›®æ ‡å€¼å’Œå•ä½ï¼ˆå¦‚"â‰¥ 40 dB"ã€"â‰¥ 1 MHz"ã€"â‰¤ 50 mW"ï¼‰
  - çº¦æŸç±»å‹ï¼ˆMinimum/Maximum/Exact/Rangeï¼‰
  - æƒé‡ï¼ˆå¦‚"30%"ï¼‰
- [ ] **ç›®æ ‡å€¼æ˜¾ç¤ºæ ¼å¼**ï¼š
  - æœ€å°å€¼ï¼ˆminimumï¼‰ï¼šæ˜¾ç¤ºä¸º `â‰¥ {value} {unit}`
  - æœ€å¤§å€¼ï¼ˆmaximumï¼‰ï¼šæ˜¾ç¤ºä¸º `â‰¤ {value} {unit}`
  - ç²¾ç¡®å€¼ï¼ˆexactï¼‰ï¼šæ˜¾ç¤ºä¸º `= {value} {unit}`
  - èŒƒå›´ï¼ˆrangeï¼‰ï¼šæ˜¾ç¤ºä¸º `{min} ~ {max} {unit}`
  - æœ€å°åŒ–ï¼ˆminimizeï¼‰ï¼šæ˜¾ç¤ºä¸º `â†“ {unit}`ï¼ˆè¶Šå°è¶Šå¥½ï¼‰
  - æœ€å¤§åŒ–ï¼ˆmaximizeï¼‰ï¼šæ˜¾ç¤ºä¸º `â†‘ {unit}`ï¼ˆè¶Šå¤§è¶Šå¥½ï¼‰

#### 8.4.3 å•ä¸ªç›®æ ‡ç¼–è¾‘

- [ ] **å•ä¸ªç›®æ ‡ç¼–è¾‘å¯¹è¯æ¡†**ï¼ˆç‚¹å‡»ç¼–è¾‘æ—¶å¼¹å‡ºï¼‰ï¼š
  - åç§°ï¼šæ–‡æœ¬è¾“å…¥æ¡†
  - ç±»å‹ï¼šä¸‹æ‹‰é€‰æ‹©ï¼ˆMinimum/Maximum/Exact/Range/Minimize/Maximizeï¼‰
  - ç›®æ ‡å€¼ï¼šæ•°å€¼è¾“å…¥æ¡†
  - å•ä½ï¼šä¸‹æ‹‰é€‰æ‹©æˆ–æ–‡æœ¬è¾“å…¥
  - å®¹å·®ï¼šæ•°å€¼è¾“å…¥æ¡†ï¼ˆç™¾åˆ†æ¯”ï¼‰
  - æƒé‡ï¼šæ•°å€¼è¾“å…¥æ¡†ï¼ˆ0-1ï¼‰
- [ ] **å¸¸ç”¨å•ä½ä¸‹æ‹‰é€‰é¡¹**ï¼ˆæŒ‰ç±»åˆ«åˆ†ç»„ï¼‰ï¼š
  - ç”µå‹ï¼šV, mV, ÂµV, nV
  - ç”µæµï¼šA, mA, ÂµA, nA, pA
  - é¢‘ç‡ï¼šHz, kHz, MHz, GHz
  - å¢ç›Šï¼šdB, V/V, A/A
  - é˜»æŠ—ï¼šÎ©, kÎ©, MÎ©, GÎ©
  - åŠŸç‡ï¼šW, mW, ÂµW, nW
  - å™ªå£°ï¼šnV/âˆšHz, pA/âˆšHz, dBm/Hz
  - æ—¶é—´ï¼šs, ms, Âµs, ns, ps
  - ç”µå®¹ï¼šF, mF, ÂµF, nF, pF
  - ç”µæ„Ÿï¼šH, mH, ÂµH, nH
  - ç›¸ä½ï¼šÂ°, rad
  - æ¸©åº¦ï¼šÂ°C, K
  - å¤±çœŸï¼š%, dB, ppm
  - å‹æ‘†ç‡ï¼šV/Âµs, V/ns
  - æ”¯æŒæ‰‹åŠ¨è¾“å…¥è‡ªå®šä¹‰å•ä½

#### 8.4.4 æ•°æ®å¤„ç†

- [ ] **æ•°æ®åŠ è½½**ï¼š
  - æ‰“å¼€å¯¹è¯æ¡†æ—¶ï¼Œä» `GraphState.design_goals` åŠ è½½å½“å‰è®¾è®¡ç›®æ ‡
  - è‹¥ GraphState ä¸å¯ç”¨ï¼Œä» `.circuit_ai/design_goals.json` åŠ è½½
- [ ] **æ•°æ®ä¿å­˜**ï¼š
  - ç”¨æˆ·ç‚¹å‡»"ç¡®è®¤"åï¼Œæ›´æ–° `GraphState.design_goals`
  - è°ƒç”¨ `DesignService.save_design_goals()` ä¿å­˜åˆ° JSON æ–‡ä»¶
  - å‘å¸ƒ `EVENT_DESIGN_GOALS_UPDATED` äº‹ä»¶
- [ ] **æ ¡éªŒè§„åˆ™**ï¼š
  - è‡³å°‘ä¿ç•™ä¸€ä¸ªè®¾è®¡ç›®æ ‡
  - ç›®æ ‡å€¼å¿…é¡»ä¸ºæœ‰æ•ˆæ•°å€¼
  - æŒ‡æ ‡åç§°ä¸èƒ½ä¸ºç©º
  - èŒƒå›´ç±»å‹çš„ç›®æ ‡ï¼Œæœ€å°å€¼å¿…é¡»å°äºæœ€å¤§å€¼
  - æ‰€æœ‰æƒé‡ä¹‹å’Œåº”ä¸º 1ï¼ˆå¯è‡ªåŠ¨å½’ä¸€åŒ–ï¼‰
- [ ] **å›½é™…åŒ–æ”¯æŒ**ï¼š
  - å®ç° `retranslate_ui()` æ–¹æ³•ï¼Œåˆ·æ–°å¯¹è¯æ¡†æ ‡é¢˜ã€æ ‡ç­¾ã€æŒ‰é’®ã€åˆ—è¡¨è¡¨å¤´ç­‰æ–‡æœ¬
  - è®¢é˜… `EVENT_LANGUAGE_CHANGED` äº‹ä»¶
  - æ‰€æœ‰ UI æ–‡æœ¬é€šè¿‡ `i18n_manager.get_text()` è·å–

#### 8.4.5 ä¸å·¥ä½œæµé›†æˆ

- [ ] **ä»èœå•æ æ‰“å¼€**ï¼š
  - ç”¨æˆ·ç¡®è®¤åï¼Œæ›´æ–°è®¾è®¡ç›®æ ‡å¹¶åŒæ­¥
  - è‹¥å·¥ä½œæµæ­£åœ¨è¿è¡Œï¼Œä¸‹ä¸€è½®è¿­ä»£å°†ä½¿ç”¨æ–°ç›®æ ‡
  - è‹¥å·¥ä½œæµæœªè¿è¡Œï¼Œä»…ä¿å­˜ç›®æ ‡ï¼Œä¸è§¦å‘ä»»ä½•æµç¨‹
- [ ] **ä»æ£€æŸ¥ç‚¹"ä¿®æ”¹ç›®æ ‡"æ‰“å¼€**ï¼š
  - ç”¨æˆ·ç¡®è®¤åï¼Œè®¾ç½® `user_intent = "modify_goals"`
  - å·¥ä½œæµæ¢å¤æ‰§è¡Œï¼Œé‡ç½® `checkpoint_count`
  - è·¯ç”±åˆ° `initial_design_node` é‡æ–°å¼€å§‹è®¾è®¡
- [ ] **ä» `design_goals_node` æ‰“å¼€ï¼ˆç¡®è®¤æ¨¡å¼ï¼‰**ï¼š
  - ç”¨æˆ·ç¡®è®¤åï¼Œç»§ç»­æ‰§è¡Œå·¥ä½œæµ
  - è·¯ç”±åˆ° `initial_design_node` å¼€å§‹åˆå§‹è®¾è®¡

#### 8.4.6 è®¾è®¡ç›®æ ‡ä½œä¸ºé«˜å±‚æç¤ºè¯æ–¹é’ˆ

- [ ] **è®¾è®¡ç›®æ ‡åœ¨ Prompt ä¸­çš„ä½œç”¨**ï¼š
  - è®¾è®¡ç›®æ ‡æ˜¯æ‰€æœ‰è®¾è®¡ç›¸å…³ Prompt çš„æ€»æ–¹é’ˆä¹‹ä¸€
  - åœ¨ `context_retrieval/implicit_context_collector.py` ä¸­è‡ªåŠ¨æ”¶é›†è®¾è®¡ç›®æ ‡
  - LLM çš„æ‰€æœ‰è®¾è®¡å†³ç­–éƒ½åº”ä»¥è¾¾æˆè®¾è®¡ç›®æ ‡ä¸ºå¯¼å‘
- [ ] **æ³¨å…¥ä½ç½®**ï¼š
  - ç³»ç»Ÿæç¤ºè¯ä¸­åŒ…å«è®¾è®¡ç›®æ ‡æ‘˜è¦
  - æ¯è½®è¿­ä»£çš„ä¸Šä¸‹æ–‡ä¸­åŒ…å«å®Œæ•´è®¾è®¡ç›®æ ‡å’Œå½“å‰è¾¾æˆçŠ¶æ€
- [ ] **ç›®æ ‡æ›´æ–°åçš„å¤„ç†**ï¼š
  - ç”¨æˆ·é€šè¿‡å¯¹è¯æ¡†ä¿®æ”¹ç›®æ ‡åï¼Œä¸‹ä¸€è½®è¿­ä»£çš„ Prompt å°†åŒ…å«æ›´æ–°åçš„ç›®æ ‡
  - LLM ä¼šæ ¹æ®æ–°ç›®æ ‡é‡æ–°è¯„ä¼°è®¾è®¡æ–¹å‘



---

### 8.5 ç”¨æˆ·æ£€æŸ¥ç‚¹æ¨¡å—ç»„ (`application/graph/nodes/checkpoint/`)

> **ç›®å½•ç»“æ„**ï¼š
> ```
> application/graph/nodes/checkpoint/
> â”œâ”€â”€ __init__.py
> â”œâ”€â”€ user_checkpoint_node.py   # æ£€æŸ¥ç‚¹èŠ‚ç‚¹ä¸»ç±»
> â””â”€â”€ suggestion_generator.py   # å»ºè®®é€‰é¡¹ç”Ÿæˆå™¨
> ```

> **æ¨¡å—ç»„æˆ**ï¼š
> - `user_checkpoint_node.py` - æ£€æŸ¥ç‚¹èŠ‚ç‚¹ä¸»ç±»
> - `suggestion_generator.py` - å»ºè®®é€‰é¡¹ç”Ÿæˆå™¨

#### 8.5.1 `user_checkpoint_node.py` - ç”¨æˆ·äº¤äº’æ£€æŸ¥ç‚¹èŠ‚ç‚¹

> **ğŸ“š å‚è€ƒ**ï¼š`LangGraph/docs/docs/concepts/human_in_the_loop.md` - interrupt æœºåˆ¶

- [ ] **æ–‡ä»¶è·¯å¾„**ï¼š`application/graph/nodes/checkpoint/user_checkpoint_node.py`
- [ ] **èŒè´£**ï¼šåœ¨æ¯æ¬¡è¿­ä»£å®Œæˆåæš‚åœï¼Œç”Ÿæˆå»ºè®®é€‰é¡¹ï¼Œç­‰å¾…ç”¨æˆ·é€‰æ‹©æˆ–è‡ªç”±è¾“å…¥
- [ ] **è§¦å‘æ—¶æœº**ï¼š`final_check_node` è¿”å› `continue` æ—¶ï¼Œæˆ– `action_node` æœªè°ƒç”¨æ–‡ä»¶ä¿®æ”¹å·¥å…·æ—¶
- [ ] **æ‰§è¡Œæµç¨‹**ï¼š
  1. è°ƒç”¨ `await SnapshotService.create_snapshot_async()` å¼‚æ­¥åˆ›å»ºå½“å‰è¿­ä»£çš„å…¨é‡å¿«ç…§
     - é€šè¿‡ `asyncio.to_thread()` å°† shutil.copytree å¸è½½åˆ°çº¿ç¨‹æ± ï¼Œä¸é˜»å¡äº‹ä»¶å¾ªç¯
     - è‡ªåŠ¨æ¸…ç†è¶…å‡ºä¿ç•™æ•°é‡çš„æ—§å¿«ç…§
  2. å§”æ‰˜ `SuggestionGenerator` ç”Ÿæˆå»ºè®®é€‰é¡¹
  3. è®¾ç½® `awaiting_user_confirmation = True`
  4. è®¾ç½® `suggested_actions` ä¸ºç”Ÿæˆçš„å»ºè®®åˆ—è¡¨
  5. å‘å¸ƒ `ITERATION_AWAITING_CONFIRMATION` äº‹ä»¶ï¼Œæºå¸¦å»ºè®®é€‰é¡¹æ•°æ®
  6. è°ƒç”¨ `interrupt(value)` æš‚åœï¼Œç­‰å¾…ç”¨æˆ·æ“ä½œ
- [ ] **å…¨é‡å¿«ç…§ä¼˜åŠ¿**ï¼š
  - å®ç°ç®€å•ï¼Œä¾èµ–æ ‡å‡†åº“ shutilï¼Œå¯é æ€§é«˜
  - å¯¹äº KB çº§åˆ«çš„ç”µè·¯æ–‡ä»¶ï¼Œå…¨é‡æ‹·è´åœ¨æ¯«ç§’çº§å®Œæˆ
  - æ— éœ€å¤„ç†å¤æ‚çš„å¢é‡é€»è¾‘ã€å“ˆå¸Œè®¡ç®—ã€åƒåœ¾å›æ”¶
  - æ¢å¤æ—¶ç›´æ¥å…¨é‡æ‹·è´ï¼Œæ— éœ€é‡å»ºæ–‡ä»¶æ ‘
- [ ] **ä¾èµ–æ¨¡å—**ï¼š
  - `SnapshotService` - å…¨é‡å¿«ç…§æœåŠ¡ï¼ˆé˜¶æ®µ 2.5ï¼‰
  - `SuggestionGenerator` - å»ºè®®é€‰é¡¹ç”Ÿæˆ
- [ ] **ç»Ÿä¸€å¯¹è¯å…¥å£è®¾è®¡**ï¼š
  - ç”¨æˆ·ä¸ AI å¯¹è¯çš„å…¥å£å§‹ç»ˆåªæœ‰ä¸€ä¸ªï¼ˆå¯¹è¯é¢æ¿çš„è¾“å…¥æ¡†ï¼‰
  - æ£€æŸ¥ç‚¹æ—¶å»ºè®®é€‰é¡¹ä½œä¸ºä¸€æ¡æ¶ˆæ¯æ˜¾ç¤ºåœ¨å¯¹è¯å†å²åŒº
  - è¾“å…¥æ¡†å§‹ç»ˆå¯ç¼–è¾‘ï¼Œç”¨æˆ·å¯ä»¥é€‰æ‹©ç‚¹å‡»å»ºè®®æ¶ˆæ¯ä¸­çš„æŒ‰é’®ï¼Œä¹Ÿå¯ä»¥ç›´æ¥åœ¨è¾“å…¥æ¡†ä¸­è‡ªç”±è¾“å…¥
- [ ] **è¾“å…¥æ¡†ä¸å‘é€æŒ‰é’®çŠ¶æ€**ï¼š
  - è¾“å…¥æ¡†å§‹ç»ˆå¯ç¼–è¾‘ï¼Œç”¨æˆ·å¯éšæ—¶è¾“å…¥å’Œä¿®æ”¹æ–‡æœ¬
  - å‘é€æŒ‰é’®åœ¨å·¥ä½œæµç©ºé—²æˆ–æ£€æŸ¥ç‚¹æš‚åœæ—¶å¯ç”¨
  - å‘é€æŒ‰é’®åœ¨ LLM å¤„ç†ä¸­æˆ–ä»¿çœŸè¿è¡Œä¸­ç¦ç”¨
- [ ] **æ¢å¤æ‰§è¡Œ**ï¼š
  - **âš ï¸ æ–°å†™æ³•**ï¼šä½¿ç”¨ `Command(resume=value)` æ¢å¤
  - resume å€¼ç»“æ„ï¼š`{"type": str, "content": Optional[str]}`
  - `type` ä¸ºç”¨æˆ·æ„å›¾ç±»å‹ï¼Œ`content` ä¸ºç”¨æˆ·è¾“å…¥å†…å®¹ï¼ˆè‡ªç”±è¾“å…¥æ—¶ï¼‰
- [ ] **ç”¨æˆ·æ„å›¾ç±»å‹**ï¼š
  - `optimize` - ç”¨æˆ·ç‚¹å‡»"ç»§ç»­ä¼˜åŒ–"æŒ‰é’®
  - `fix_error` - ç”¨æˆ·ç‚¹å‡»"ä¿®å¤é”™è¯¯"æŒ‰é’®
  - `modify_goals` - ç”¨æˆ·ç‚¹å‡»"ä¿®æ”¹ç›®æ ‡"æŒ‰é’®
  - `accept` - ç”¨æˆ·ç‚¹å‡»"æ¥å—è®¾è®¡"æŒ‰é’®
  - `stop` - ç”¨æˆ·ç‚¹å‡»"åœæ­¢è®¾è®¡"æŒ‰é’®
  - `undo` - ç”¨æˆ·ç‚¹å‡»"æ’¤å›"æŒ‰é’®
  - `free_input` - ç”¨æˆ·è‡ªç”±è¾“å…¥ï¼ˆç»Ÿä¸€ç±»å‹ï¼Œç”± LLM è‡ªè¡Œå†³å®šå“åº”æ–¹å¼ï¼‰
- [ ] **ä¾èµ–æ¨¡å—**ï¼š
  - `SuggestionGenerator` - å»ºè®®é€‰é¡¹ç”Ÿæˆ
- [ ] **è¾“å‡º**ï¼š`awaiting_user_confirmation = False`ã€`user_intent`ã€`user_message`ï¼ˆè‹¥æœ‰ï¼‰

#### 8.5.2 `suggestion_generator.py` - å»ºè®®é€‰é¡¹ç”Ÿæˆå™¨

- [ ] **æ–‡ä»¶è·¯å¾„**ï¼š`application/graph/nodes/checkpoint/suggestion_generator.py`
- [ ] **èŒè´£**ï¼šä¸“æ³¨äºæ ¹æ®å½“å‰è®¾è®¡çŠ¶æ€åŠ¨æ€ç”Ÿæˆå»ºè®®é€‰é¡¹ï¼Œä¾›å»ºè®®é€‰é¡¹æ¶ˆæ¯æ˜¾ç¤º
- [ ] **ä¾èµ–æ¨¡å—**ï¼š
  - `FixAttemptTracker` - ä¿®å¤å°è¯•è¿½è¸ªå™¨ï¼ˆç”¨äºç†”æ–­çŠ¶æ€åˆ¤æ–­ï¼‰
- [ ] **æ ¸å¿ƒåŠŸèƒ½**ï¼š
  - `generate(state)` - æ ¹æ®çŠ¶æ€ç”Ÿæˆå»ºè®®é€‰é¡¹åˆ—è¡¨å’ŒçŠ¶æ€æ‘˜è¦
  - `generate_status_summary(state)` - ç”ŸæˆçŠ¶æ€æ‘˜è¦æ–‡æœ¬ï¼ˆå¦‚"è¿­ä»£ 3 å®Œæˆï¼Œå¢ç›Š 18dB/ç›®æ ‡ 20dB"ï¼‰
  - `_should_show_fix_error(state)` - åˆ¤æ–­æ˜¯å¦æ˜¾ç¤º"ä¿®å¤é”™è¯¯"é€‰é¡¹
  - `_should_enable_fix_error(state)` - åˆ¤æ–­"ä¿®å¤é”™è¯¯"é€‰é¡¹æ˜¯å¦å¯ç”¨ï¼ˆç†”æ–­æ£€æŸ¥ï¼‰
  - `_should_show_accept(state)` - åˆ¤æ–­æ˜¯å¦æ˜¾ç¤º"æ¥å—è®¾è®¡"é€‰é¡¹
  - `_should_highlight_modify_goals(state)` - åˆ¤æ–­æ˜¯å¦é«˜äº®"ä¿®æ”¹ç›®æ ‡"é€‰é¡¹
- [ ] **å»ºè®®é€‰é¡¹ç”Ÿæˆè§„åˆ™**ï¼š
  - æ ¹æ® `simulation_success` åˆ¤æ–­æ˜¯å¦æ˜¾ç¤º"ä¿®å¤é”™è¯¯"é€‰é¡¹
  - æ ¹æ® `FixAttemptTracker.is_circuit_breaker_triggered()` åˆ¤æ–­"ä¿®å¤é”™è¯¯"æ˜¯å¦å¯ç”¨
  - æ ¹æ® `performance_score >= threshold` åˆ¤æ–­æ˜¯å¦æ˜¾ç¤º"æ¥å—è®¾è®¡"é€‰é¡¹
  - æ ¹æ® `stagnation_count >= 2` æˆ–ç†”æ–­è§¦å‘åˆ¤æ–­æ˜¯å¦é«˜äº®å»ºè®®"ä¿®æ”¹ç›®æ ‡"
  - å§‹ç»ˆæ˜¾ç¤º"ç»§ç»­ä¼˜åŒ–"ã€"åœæ­¢è®¾è®¡"å’Œ"æ’¤å›"é€‰é¡¹
- [ ] **ç†”æ–­çŠ¶æ€ä¸‹çš„ç‰¹æ®Šå¤„ç†**ï¼š
  - "ä¿®å¤é”™è¯¯"æŒ‰é’®æ˜¾ç¤ºä½†ç¦ç”¨ï¼Œtooltip æç¤º"è¿ç»­ä¿®å¤å¤±è´¥æ¬¡æ•°è¿‡å¤š"
  - "ä¿®æ”¹ç›®æ ‡"æŒ‰é’®é«˜äº®æ˜¾ç¤ºï¼Œå»ºè®®ç”¨æˆ·é‡æ–°è¯„ä¼°è®¾è®¡ç›®æ ‡
  - çŠ¶æ€æ‘˜è¦è¿½åŠ ç†”æ–­æç¤ºæ–‡æœ¬
- [ ] **è¢«è°ƒç”¨æ–¹**ï¼š`user_checkpoint_node.py`

---

### 8.6 è¡ŒåŠ¨å¤„ç†æ¨¡å—ç»„ (`application/graph/nodes/actions/`)

> **ç›®å½•ç»“æ„**ï¼š
> ```
> application/graph/nodes/actions/
> â”œâ”€â”€ __init__.py
> â”œâ”€â”€ action_node.py            # è¡ŒåŠ¨å¤„ç†èŠ‚ç‚¹ï¼ˆç»Ÿä¸€å…¥å£ï¼‰
> â”œâ”€â”€ base_action.py            # è¡ŒåŠ¨å¤„ç†å™¨åŸºç±»
> â”œâ”€â”€ optimize_action.py        # å‚æ•°ä¼˜åŒ–è¡ŒåŠ¨å¤„ç†å™¨
> â”œâ”€â”€ fix_error_action.py       # é”™è¯¯ä¿®å¤è¡ŒåŠ¨å¤„ç†å™¨
> â”œâ”€â”€ fix_attempt_tracker.py    # ä¿®å¤å°è¯•è¿½è¸ªå™¨ï¼ˆç†”æ–­æœºåˆ¶ï¼‰
> â”œâ”€â”€ error_context_builder.py  # é”™è¯¯ä¸Šä¸‹æ–‡æ„å»ºå™¨
> â””â”€â”€ modify_goals_action.py    # ç›®æ ‡ä¿®æ”¹è¡ŒåŠ¨å¤„ç†å™¨
> ```

> **æ¨¡å—ç»„æˆ**ï¼š
> - `action_node.py` - è¡ŒåŠ¨å¤„ç†èŠ‚ç‚¹ï¼ˆç»Ÿä¸€å…¥å£ï¼‰
> - `base_action.py` - è¡ŒåŠ¨å¤„ç†å™¨åŸºç±»
> - `optimize_action.py` - å‚æ•°ä¼˜åŒ–è¡ŒåŠ¨å¤„ç†å™¨
> - `fix_error_action.py` - é”™è¯¯ä¿®å¤è¡ŒåŠ¨å¤„ç†å™¨
> - `fix_attempt_tracker.py` - ä¿®å¤å°è¯•è¿½è¸ªå™¨ï¼ˆå•ä¸€èŒè´£ï¼Œç†”æ–­æœºåˆ¶ï¼‰
> - `error_context_builder.py` - é”™è¯¯ä¸Šä¸‹æ–‡æ„å»ºå™¨ï¼ˆèŒè´£å•ä¸€ï¼Œå¯å¤ç”¨ï¼‰
> - `modify_goals_action.py` - ç›®æ ‡ä¿®æ”¹è¡ŒåŠ¨å¤„ç†å™¨

#### 8.6.1 `action_node.py` - è¡ŒåŠ¨å¤„ç†èŠ‚ç‚¹

- [ ] **æ–‡ä»¶è·¯å¾„**ï¼š`application/graph/nodes/action_node.py`
- [ ] **èŒè´£**ï¼šç»Ÿä¸€å¤„ç†ç”¨æˆ·çš„å„ç§è¡ŒåŠ¨è¯·æ±‚ï¼ŒåŒ…æ‹¬é¢„è®¾æŒ‰é’®å’Œè‡ªç”±è¾“å…¥
- [ ] **è§¦å‘æ—¶æœº**ï¼šç”¨æˆ·åœ¨æ£€æŸ¥ç‚¹é€‰æ‹©è¡ŒåŠ¨æˆ–è‡ªç”±è¾“å…¥å
- [ ] **æ ¸å¿ƒåŠŸèƒ½**ï¼š
  - `execute(state)` - èŠ‚ç‚¹æ‰§è¡Œå…¥å£
  - `_handle_preset_action(intent_type, state)` - å¤„ç†é¢„è®¾æŒ‰é’®è¡ŒåŠ¨
  - `_handle_free_input(user_message, state)` - å¤„ç†è‡ªç”±è¾“å…¥
  - `_determine_next_node(tool_calls)` - æ ¹æ®å·¥å…·è°ƒç”¨å†³å®šåç»­èŠ‚ç‚¹

##### Agentic Loop é›†æˆï¼ˆæ ¸å¿ƒæœºåˆ¶ï¼‰

> **è®¾è®¡è¯´æ˜**ï¼š`action_node` å†…éƒ¨ä½¿ç”¨ `AgenticLoopController`ï¼ˆé˜¶æ®µä¸‰ 3.3.2 èŠ‚ï¼‰å®ç°å¤šè½®å·¥å…·è°ƒç”¨ã€‚æ— è®ºæ˜¯é¢„è®¾æŒ‰é’®è¿˜æ˜¯è‡ªç”±è¾“å…¥ï¼Œéƒ½é€šè¿‡ Agentic Loop å¤„ç†ï¼Œç¡®ä¿ LLM å¯ä»¥è‡ªä¸»å†³å®šè°ƒç”¨å¤šå°‘æ¬¡å·¥å…·ã€‚

> **âš ï¸ çº¿ç¨‹æ¨¡å‹**ï¼šAgentic Loop é€šè¿‡ `AsyncTaskManager.submit()` æäº¤åˆ°ä¸»çº¿ç¨‹çš„ qasync èåˆäº‹ä»¶å¾ªç¯ä¸­æ‰§è¡Œï¼ˆè¯¦è§é˜¶æ®µä¸‰ 3.0 èŠ‚å’Œ 3.3.2.7 èŠ‚ï¼‰ã€‚æµå¼è¾“å‡ºå’Œè¿›åº¦æ›´æ–°é€šè¿‡ pyqtSignal ç›´æ¥å‘é€ï¼ˆåŒçº¿ç¨‹ï¼‰ï¼Œç¡®ä¿ UI å“åº”ã€‚

- [ ] **æ‰§è¡Œæµç¨‹**ï¼ˆä½¿ç”¨ Agentic Loopï¼‰ï¼š
  1. ä» `GraphState.user_intent` è·å–ç”¨æˆ·æ„å›¾ç±»å‹
  2. è‹¥ä¸ºé¢„è®¾æŒ‰é’®ï¼ˆ`optimize`/`fix_error`/`modify_goals`ï¼‰ï¼š
     - å§”æ‰˜å¯¹åº”å¤„ç†å™¨æ„å»ºç‰¹å®š Prompt
     - å¤„ç†å™¨é€šè¿‡ `AsyncTaskManager.submit()` æäº¤ Agentic Loop ä»»åŠ¡
  3. è‹¥ä¸ºè‡ªç”±è¾“å…¥ï¼ˆ`free_input`ï¼‰ï¼š
     - ä½¿ç”¨ `FREE_INPUT_RESPONSE` Prompt æ¨¡æ¿
     - é€šè¿‡ `AsyncTaskManager.submit()` æäº¤ Agentic Loop ä»»åŠ¡
     - åœ¨ qasync èåˆå¾ªç¯ä¸­æ‰§è¡Œ Agentic Loop
  4. await ç­‰å¾… `loop_state` è¿”å›
  5. æ£€æŸ¥ `loop_state.tool_calls_history` æ˜¯å¦åŒ…å«æ–‡ä»¶ä¿®æ”¹å·¥å…·
  6. è‹¥è°ƒç”¨äº†æ–‡ä»¶ä¿®æ”¹å·¥å…· â†’ è¿”å› `simulation_node`
  7. è‹¥æœªè°ƒç”¨æ–‡ä»¶ä¿®æ”¹å·¥å…· â†’ è¿”å› `user_checkpoint_node`
- [ ] **å¤šæ¬¡ API è¯·æ±‚è¯´æ˜**ï¼š
  - é¢„è®¾æŒ‰é’®å’Œè‡ªç”±è¾“å…¥éƒ½å¯èƒ½è§¦å‘å¤šæ¬¡ LLM API è¯·æ±‚
  - ä¾‹å¦‚"ç»§ç»­ä¼˜åŒ–"å¯èƒ½éœ€è¦ï¼šåˆ†æå½“å‰çŠ¶æ€ â†’ è¯»å–æ–‡ä»¶ â†’ ä¿®æ”¹å‚æ•° â†’ ç¡®è®¤ä¿®æ”¹
  - æ¯ä¸ªæ­¥éª¤éƒ½æ˜¯ä¸€æ¬¡ç‹¬ç«‹çš„ API è¯·æ±‚
- [ ] **é¢„è®¾æ„å›¾ä¸å¤„ç†å™¨æ˜ å°„**ï¼š
  - `optimize` â†’ `OptimizeAction`ï¼ˆå†…éƒ¨ä½¿ç”¨ Agentic Loopï¼‰
  - `fix_error` â†’ `FixErrorAction`ï¼ˆå†…éƒ¨ä½¿ç”¨ Agentic Loopï¼‰
  - `modify_goals` â†’ `ModifyGoalsAction`ï¼ˆå¼¹å‡ºå¯¹è¯æ¡†ï¼Œä¸ä½¿ç”¨ Agentic Loopï¼‰
- [ ] **è‡ªç”±è¾“å…¥å¤„ç†**ï¼š
  - ä½¿ç”¨ `FREE_INPUT_RESPONSE` Prompt æ¨¡æ¿
  - LLM å¯è‡ªè¡Œå†³å®šï¼šä»…å›ç­”é—®é¢˜ã€ä»…æ‰§è¡Œæ“ä½œã€æˆ–ä¸¤è€…å…¼é¡¾
  - é€šè¿‡ Agentic Loop æ”¯æŒå¤šè½®å·¥å…·è°ƒç”¨
  - å°†å®Œæ•´å¯¹è¯å†å²ï¼ˆå«å·¥å…·è°ƒç”¨ï¼‰è¿½åŠ åˆ° `messages`
- [ ] **åç»­èŠ‚ç‚¹åˆ¤æ–­**ï¼š
  - æ£€æŸ¥ `loop_state.tool_calls_history` æ˜¯å¦åŒ…å«æ–‡ä»¶ä¿®æ”¹å·¥å…·
  - æ–‡ä»¶ä¿®æ”¹å·¥å…·åˆ—è¡¨ï¼š`rewrite_file`ã€`patch_file`
- [ ] **è¾“å‡º**ï¼šæ›´æ–°åçš„ `messages`ã€`current_parameters`ï¼ˆè‹¥æœ‰ä¿®æ”¹ï¼‰ã€`next_node`

#### 8.6.2 `base_action.py` - è¡ŒåŠ¨å¤„ç†å™¨åŸºç±»

- [ ] **æ–‡ä»¶è·¯å¾„**ï¼š`application/graph/nodes/actions/base_action.py`
- [ ] **èŒè´£**ï¼šå®šä¹‰æ‰€æœ‰è¡ŒåŠ¨å¤„ç†å™¨çš„å…¬å…±æ¥å£å’Œå…±äº«é€»è¾‘
- [ ] **æŠ½è±¡æ–¹æ³•**ï¼š
  - `execute(state)` - æ‰§è¡Œè¡ŒåŠ¨ï¼Œè¿”å›æ›´æ–°åçš„çŠ¶æ€
  - `get_prompt_template()` - è·å–å¯¹åº”çš„ Prompt æ¨¡æ¿åç§°
  - `get_next_node()` - è·å–åç»­èŠ‚ç‚¹åç§°
- [ ] **å…¬å…±æ–¹æ³•**ï¼š
  - `call_llm(state, template_name, context)` - è°ƒç”¨ LLM ç”Ÿæˆæ–¹æ¡ˆ
  - `execute_file_operations(state, operations)` - æ‰§è¡Œæ–‡ä»¶æ“ä½œ
  - `update_parameters(state, new_params)` - æ›´æ–°ç”µè·¯å‚æ•°
  - `clear_user_intent(state)` - æ¸…é™¤ç”¨æˆ·æ„å›¾æ ‡è®°
- [ ] **è¢«è°ƒç”¨æ–¹**ï¼šæ‰€æœ‰å…·ä½“è¡ŒåŠ¨å¤„ç†å™¨

#### 8.6.3 `optimize_action.py` - å‚æ•°ä¼˜åŒ–è¡ŒåŠ¨å¤„ç†å™¨

- [ ] **æ–‡ä»¶è·¯å¾„**ï¼š`application/graph/nodes/actions/optimize_action.py`
- [ ] **èŒè´£**ï¼šä¸“æ³¨äºå¤„ç†"ç»§ç»­ä¼˜åŒ–"è¡ŒåŠ¨ï¼Œç”Ÿæˆå‚æ•°è°ƒæ•´æ–¹æ¡ˆ
- [ ] **ç»§æ‰¿**ï¼š`BaseAction`
- [ ] **æ‰§è¡Œæµç¨‹**ï¼š
  1. æ„å»ºä¼˜åŒ–ä¸Šä¸‹æ–‡ï¼ŒåŒ…å«å½“å‰æ€§èƒ½æŒ‡æ ‡ã€ç›®æ ‡å·®è·ã€å†å²ä¼˜åŒ–è®°å½•
  2. ä½¿ç”¨ `OPTIMIZE_PARAMETERS` Prompt æ¨¡æ¿
  3. è°ƒç”¨ `llm_worker` ç”Ÿæˆå‚æ•°è°ƒæ•´æ–¹æ¡ˆ
  4. é€šè¿‡ `tool_node` è°ƒç”¨ `rewrite_file` æˆ– `patch_file` æ‰§è¡Œæ–‡ä»¶ä¿®æ”¹
  5. æ›´æ–° `current_parameters`ã€`checkpoint_count`
  6. æ¸…é™¤ `user_intent`
- [ ] **Prompt ä¸Šä¸‹æ–‡æ³¨å…¥**ï¼š
  - å½“å‰æ€§èƒ½æŒ‡æ ‡ä¸ç›®æ ‡å€¼å¯¹æ¯”
  - å„æŒ‡æ ‡çš„å·®è·ç™¾åˆ†æ¯”
  - å†å²ä¼˜åŒ–è®°å½•ï¼ˆæœ€è¿‘ 3-5 è½®çš„è°ƒæ•´æ–¹å‘å’Œæ•ˆæœï¼‰
  - å»ºè®®çš„ä¼˜åŒ–æ–¹å‘
- [ ] **åç»­èŠ‚ç‚¹**ï¼š`simulation_node`
- [ ] **è¾“å‡º**ï¼šæ›´æ–°åçš„ `current_parameters`ã€`checkpoint_count`

#### 8.6.4 `fix_error_action.py` - é”™è¯¯ä¿®å¤è¡ŒåŠ¨å¤„ç†å™¨

- [ ] **æ–‡ä»¶è·¯å¾„**ï¼š`application/graph/nodes/actions/fix_error_action.py`
- [ ] **èŒè´£**ï¼šä¸“æ³¨äºå¤„ç†"ä¿®å¤é”™è¯¯"è¡ŒåŠ¨ï¼Œåˆ†æå¹¶ä¿®å¤ä»¿çœŸé”™è¯¯
- [ ] **ç»§æ‰¿**ï¼š`BaseAction`
- [ ] **ä¾èµ–æ¨¡å—**ï¼š
  - `FixAttemptTracker` - ä¿®å¤å°è¯•è¿½è¸ªå™¨ï¼ˆç†”æ–­æ£€æŸ¥ï¼‰
  - `ErrorContextBuilder` - é”™è¯¯ä¸Šä¸‹æ–‡æ„å»ºå™¨
  - `AgenticLoopController` - Agentic Loop æ§åˆ¶å™¨ï¼ˆé˜¶æ®µä¸‰ï¼‰
- [ ] **è®¾è®¡åŸåˆ™**ï¼š
  - ä¸é‡å¤è¿è¡Œä»¿çœŸï¼Œç›´æ¥å¤ç”¨ `GraphState.last_simulation_error` ä¸­çš„é”™è¯¯ä¿¡æ¯
  - é”™è¯¯ä¿¡æ¯ç”± `simulation_node` åœ¨ä»¿çœŸå¤±è´¥æ—¶æ”¶é›†ï¼Œæ•°æ®æ–°é²œåº¦æœ‰ä¿è¯
  - é€šè¿‡ `ErrorContextBuilder` æ„å»ºä¸°å¯Œçš„é”™è¯¯ä¸Šä¸‹æ–‡ï¼Œå¸®åŠ© LLM ç†è§£é—®é¢˜
  - æ‰§è¡Œå‰æ£€æŸ¥ç†”æ–­çŠ¶æ€ï¼Œé˜²æ­¢æ— é™ä¿®å¤å¾ªç¯
- [ ] **æ‰§è¡Œæµç¨‹**ï¼š
  1. è°ƒç”¨ `FixAttemptTracker.is_circuit_breaker_triggered(state)` æ£€æŸ¥ç†”æ–­çŠ¶æ€
  2. è‹¥ç†”æ–­å·²è§¦å‘ï¼Œè¿”å›æç¤ºä¿¡æ¯å¹¶å»ºè®®ç”¨æˆ·ä¿®æ”¹ç›®æ ‡æˆ–åœæ­¢è®¾è®¡
  3. ä» `GraphState.last_simulation_error` è¯»å–å·²æœ‰é”™è¯¯ä¿¡æ¯
  4. æ ¡éªŒé”™è¯¯ä¿¡æ¯æ˜¯å¦å­˜åœ¨ï¼ˆè¾¹ç•Œæƒ…å†µå¤„ç†ï¼‰
  5. å§”æ‰˜ `ErrorContextBuilder` æ„å»ºé”™è¯¯ä¿®å¤ä¸Šä¸‹æ–‡
  6. ä½¿ç”¨ `FIX_ERROR` Prompt æ¨¡æ¿
  7. é€šè¿‡ Agentic Loop è°ƒç”¨ LLM åˆ†æé”™è¯¯åŸå› å¹¶ç”Ÿæˆä¿®å¤æ–¹æ¡ˆ
  8. æ‰§è¡Œæ–‡ä»¶ä¿®æ”¹
  9. è°ƒç”¨ `FixAttemptTracker.increment(state)` å¢åŠ å°è¯•è®¡æ•°
  10. æ¸…é™¤ `user_intent`
- [ ] **ç†”æ–­è§¦å‘æ—¶çš„å¤„ç†**ï¼š
  - ä¸æ‰§è¡Œ LLM è°ƒç”¨å’Œæ–‡ä»¶ä¿®æ”¹
  - è¿”å›ç”¨æˆ·å‹å¥½çš„æç¤ºä¿¡æ¯
  - å»ºè®®ç”¨æˆ·é€‰æ‹©"ä¿®æ”¹ç›®æ ‡"æˆ–"åœæ­¢è®¾è®¡"
  - æç¤ºä¿¡æ¯åŒ…å«å·²å°è¯•æ¬¡æ•°å’Œå¯èƒ½çš„åŸå› åˆ†æ
- [ ] **è¾¹ç•Œæƒ…å†µå¤„ç†**ï¼š
  - è‹¥ `last_simulation_error` ä¸ºç©ºï¼Œè¿”å›æç¤ºä¿¡æ¯"æ²¡æœ‰éœ€è¦ä¿®å¤çš„ä»¿çœŸé”™è¯¯"
  - è‹¥é”™è¯¯ä¿¡æ¯ä¸å®Œæ•´ï¼Œä½¿ç”¨å¯ç”¨ä¿¡æ¯æ„å»ºä¸Šä¸‹æ–‡ï¼Œç¼ºå¤±å­—æ®µæ ‡è®°ä¸º"æœªçŸ¥"
- [ ] **åç»­èŠ‚ç‚¹**ï¼š`simulation_node`
- [ ] **è¾“å‡º**ï¼šæ›´æ–°åçš„ `current_parameters`ã€`consecutive_fix_attempts`

#### 8.6.4.1 `error_context_builder.py` - é”™è¯¯ä¸Šä¸‹æ–‡æ„å»ºå™¨

- [ ] **æ–‡ä»¶è·¯å¾„**ï¼š`application/graph/nodes/actions/error_context_builder.py`
- [ ] **èŒè´£**ï¼šä¸“æ³¨äºä» GraphState å’Œç”µè·¯æ–‡ä»¶æ„å»º LLM å¯ç†è§£çš„é”™è¯¯ä¸Šä¸‹æ–‡
- [ ] **è®¾è®¡åŸåˆ™**ï¼š
  - å•ä¸€èŒè´£ï¼šåªè´Ÿè´£æ„å»ºé”™è¯¯ä¸Šä¸‹æ–‡ï¼Œä¸æ‰§è¡Œä»¿çœŸæˆ–ä¿®å¤
  - å¯å¤ç”¨ï¼šå¯è¢« `FixErrorAction` å’Œ `diagnostics_collector` å…±åŒä½¿ç”¨
- [ ] **æ ¸å¿ƒåŠŸèƒ½**ï¼š
  - `build_context(state, file_manager) -> ErrorContext` - æ„å»ºå®Œæ•´é”™è¯¯ä¸Šä¸‹æ–‡
  - `extract_code_context(file_path, line_number, context_lines) -> str` - æå–é”™è¯¯è¡Œé™„è¿‘ä»£ç 
  - `format_error_summary(error_info) -> str` - æ ¼å¼åŒ–é”™è¯¯æ‘˜è¦
  - `get_recovery_suggestions(error_type) -> list[str]` - è·å–é”™è¯¯ç±»å‹å¯¹åº”çš„ä¿®å¤å»ºè®®
- [ ] **ErrorContext æ•°æ®ç»“æ„**ï¼š
  ```python
  {
    "error_type": str,           # é”™è¯¯ç±»å‹ï¼ˆè¯­æ³•é”™è¯¯/æ”¶æ•›å¤±è´¥/æ¨¡å‹ç¼ºå¤±ç­‰ï¼‰
    "error_message": str,        # åŸå§‹é”™è¯¯æ¶ˆæ¯
    "error_file": str,           # å‡ºé”™æ–‡ä»¶è·¯å¾„
    "error_line": int,           # å‡ºé”™è¡Œå·ï¼ˆå¯èƒ½ä¸º Noneï¼‰
    "code_context": str,         # é”™è¯¯è¡Œé™„è¿‘çš„ä»£ç ï¼ˆå¸¦è¡Œå·æ ‡è®°ï¼‰
    "circuit_structure": str,    # ç”µè·¯æ–‡ä»¶ç»“æ„æ‘˜è¦
    "recovery_suggestions": list, # é’ˆå¯¹è¯¥é”™è¯¯ç±»å‹çš„ä¿®å¤å»ºè®®
    "formatted_prompt_section": str, # æ ¼å¼åŒ–åå¯ç›´æ¥æ³¨å…¥ Prompt çš„æ–‡æœ¬
  }
  ```
- [ ] **ä»£ç ä¸Šä¸‹æ–‡æå–è§„åˆ™**ï¼š
  - æå–é”™è¯¯è¡Œå‰åå„ 5 è¡Œä»£ç 
  - é”™è¯¯è¡Œä½¿ç”¨ `>>>` æ ‡è®°é«˜äº®
  - æ¯è¡Œæ˜¾ç¤ºè¡Œå·ï¼Œä¾¿äº LLM å®šä½
  - ç¤ºä¾‹æ ¼å¼ï¼š
    ```
        10: .param R1=10k
        11: .param R2=20k
    >>> 12: R1 in out R1_value  ; è¯­æ³•é”™è¯¯è¡Œ
        13: R2 out gnd R2
        14: .end
    ```
- [ ] **é”™è¯¯ç±»å‹ä¸ä¿®å¤å»ºè®®æ˜ å°„**ï¼š
  - `SYNTAX_ERROR` â†’ ["æ£€æŸ¥å…ƒä»¶åç§°æ‹¼å†™", "æ£€æŸ¥èŠ‚ç‚¹è¿æ¥è¯­æ³•", "ç¡®è®¤å‚æ•°æ ¼å¼æ­£ç¡®"]
  - `MODEL_MISSING` â†’ ["æ·»åŠ ç¼ºå¤±çš„ .model å®šä¹‰", "æ£€æŸ¥ .include è·¯å¾„æ˜¯å¦æ­£ç¡®"]
  - `NODE_FLOATING` â†’ ["ä¸ºæµ®ç©ºèŠ‚ç‚¹æ·»åŠ åˆ°åœ°çš„è·¯å¾„", "æ£€æŸ¥èŠ‚ç‚¹è¿æ¥æ˜¯å¦å®Œæ•´"]
  - `CONVERGENCE_DC` â†’ ["æ·»åŠ åˆå§‹æ¡ä»¶ .ic", "è°ƒæ•´ gmin å‚æ•°", "æ£€æŸ¥ç”µè·¯æ‹“æ‰‘"]
  - `CONVERGENCE_TRAN` â†’ ["å‡å°æ—¶é—´æ­¥é•¿", "æ·»åŠ  .options è°ƒæ•´æ”¶æ•›å‚æ•°"]
- [ ] **è¢«è°ƒç”¨æ–¹**ï¼š`fix_error_action.py`ã€`diagnostics_collector.py`

#### 8.6.5 `modify_goals_action.py` - ç›®æ ‡ä¿®æ”¹è¡ŒåŠ¨å¤„ç†å™¨

- [ ] **æ–‡ä»¶è·¯å¾„**ï¼š`application/graph/nodes/actions/modify_goals_action.py`
- [ ] **èŒè´£**ï¼šä¸“æ³¨äºå¤„ç†"ä¿®æ”¹ç›®æ ‡"è¡ŒåŠ¨ï¼Œå¼¹å‡ºå¯¹è¯æ¡†è®©ç”¨æˆ·ç¼–è¾‘è®¾è®¡ç›®æ ‡
- [ ] **ç»§æ‰¿**ï¼š`BaseAction`
- [ ] **æ‰§è¡Œæµç¨‹**ï¼š
  1. å¼¹å‡º `DesignGoalsEditDialog` å¯¹è¯æ¡†
  2. å¯¹è¯æ¡†åŠ è½½å½“å‰ `GraphState.design_goals` å†…å®¹
  3. ç”¨æˆ·åœ¨å¯¹è¯æ¡†ä¸­æŸ¥çœ‹å’Œç¼–è¾‘è®¾è®¡ç›®æ ‡
  4. ç”¨æˆ·ç¡®è®¤åï¼Œæ›´æ–° `GraphState.design_goals`
  5. è°ƒç”¨ `DesignService.save_design_goals()` ä¿å­˜åˆ° JSON æ–‡ä»¶
  6. é‡ç½® `checkpoint_count = 0`
  7. æ¸…é™¤ `user_intent`
- [ ] **ä¸ UI çš„äº¤äº’**ï¼š
  - ä½¿ç”¨ `interrupt()` æš‚åœç­‰å¾…ç”¨æˆ·åœ¨å¯¹è¯æ¡†ä¸­ç¡®è®¤
  - ç”¨æˆ·ç¡®è®¤åé€šè¿‡ `Command(resume=goals)` æ¢å¤æ‰§è¡Œ
- [ ] **åç»­èŠ‚ç‚¹**ï¼š`initial_design_node`ï¼ˆè·³è¿‡ `design_goals_node`ï¼Œå› ä¸ºç›®æ ‡å·²ç”±ç”¨æˆ·æ‰‹åŠ¨ç¼–è¾‘ï¼‰
- [ ] **è¾“å‡º**ï¼šæ›´æ–°åçš„ `design_goals`ã€é‡ç½®çš„ `checkpoint_count`

---

### 8.7 ç»ˆæ­¢ä¸æ’¤å›èŠ‚ç‚¹

#### 8.7.1 `accept_node.py` - æ¥å—è®¾è®¡èŠ‚ç‚¹

> **è®¾è®¡ç†å¿µ**ï¼šç”¨æˆ·ç¡®è®¤å½“å‰è®¾è®¡æ»¡è¶³éœ€æ±‚æ—¶ï¼Œæ‰§è¡Œæœ€ç»ˆä¿å­˜å’ŒæŠ¥å‘Šç”Ÿæˆã€‚

- [ ] **æ–‡ä»¶è·¯å¾„**ï¼š`application/graph/nodes/accept_node.py`
- [ ] **èŒè´£**ï¼šä¿å­˜æ‰€æœ‰å·²ä¿®æ”¹æ–‡ä»¶ï¼Œç”Ÿæˆè®¾è®¡æŠ¥å‘Šï¼Œæ ‡è®°è®¾è®¡å®Œæˆ
- [ ] **è§¦å‘æ—¶æœº**ï¼šç”¨æˆ·åœ¨æ£€æŸ¥ç‚¹ç‚¹å‡»"æ¥å—è®¾è®¡"æŒ‰é’®
- [ ] **æ‰§è¡Œæµç¨‹**ï¼š
  1. è°ƒç”¨ `file_manager.save_all_modified_files()` ä¿å­˜æ‰€æœ‰å·²ä¿®æ”¹çš„æ–‡ä»¶
  2. è°ƒç”¨ `report_generator.generate_report()` ç”Ÿæˆ PDF è®¾è®¡æŠ¥å‘Š
  3. æ›´æ–° `GraphState.is_completed = True`
  4. æ›´æ–° `GraphState.termination_reason = "user_accepted"`
  5. å‘å¸ƒ `EVENT_DESIGN_COMPLETED` äº‹ä»¶
  6. åœ¨å¯¹è¯é¢æ¿æ˜¾ç¤ºå®Œæˆæ¶ˆæ¯å’ŒæŠ¥å‘Šé“¾æ¥
- [ ] **è¾“å‡º**ï¼š`is_completed = True`ã€`termination_reason`ã€ç”Ÿæˆçš„æŠ¥å‘Šè·¯å¾„

#### 8.7.2 `undo_node.py` - æ’¤å›èŠ‚ç‚¹

> **è®¾è®¡ç†å¿µ**ï¼šç”¨æˆ·å¸Œæœ›å›é€€åˆ°ä¸Šä¸€ä¸ªè¿­ä»£çŠ¶æ€æ—¶ï¼Œæ‰§è¡Œçº¿æ€§æ’¤å›ï¼šæ¢å¤æ–‡ä»¶å¿«ç…§ + é‡å»º GraphStateã€‚ä½¿ç”¨ WAL æ¢å¤æ—¥å¿—ä¿éšœå´©æºƒä¸€è‡´æ€§ã€‚

- [ ] **æ–‡ä»¶è·¯å¾„**ï¼š`application/graph/nodes/undo_node.py`
- [ ] **èŒè´£**ï¼šæ¢å¤åˆ°ä¸Šä¸€ä¸ªè¿­ä»£æ£€æŸ¥ç‚¹çš„å®Œæ•´çŠ¶æ€
- [ ] **è§¦å‘æ—¶æœº**ï¼šç”¨æˆ·åœ¨æ£€æŸ¥ç‚¹ç‚¹å‡»"æ’¤å›"æŒ‰é’®
- [ ] **æ‰§è¡Œæµç¨‹**ï¼š
  1. **é¢„æ£€æŸ¥ï¼ˆPre-flight Checkï¼‰**
     - è°ƒç”¨ `SnapshotService.get_previous_snapshot()` è·å–ä¸Šä¸€ä¸ªå¿«ç…§
     - è‹¥æ— å¯æ’¤å›çš„å¿«ç…§ï¼ˆç¬¬ä¸€æ¬¡è¿­ä»£ï¼‰ï¼Œæ˜¾ç¤ºæç¤ºä¿¡æ¯å¹¶è¿”å›
     - éªŒè¯ç›®æ ‡å¿«ç…§å­˜åœ¨ä¸”å®Œæ•´
     - éªŒè¯ç£ç›˜ç©ºé—´è¶³å¤Ÿ
  2. **å†™å…¥æ¢å¤æ„å›¾æ—¥å¿—**
     - è°ƒç”¨ `RecoveryLogService.write_log({action: "undo", phase: "started", target_snapshot: snapshot_id})`
     - ä½¿ç”¨åŸå­å†™å…¥ï¼ˆå†™ä¸´æ—¶æ–‡ä»¶ + os.replaceï¼‰
  3. **æ¢å¤æ–‡ä»¶å¿«ç…§**
     - è°ƒç”¨ `await SnapshotService.restore_snapshot_async(project_root, previous_snapshot_id)`
     - ä»å¿«ç…§ç›®å½•å…¨é‡æ¢å¤é¡¹ç›®æ–‡ä»¶
     - æ›´æ–°æ—¥å¿—ï¼š`RecoveryLogService.update_phase("files_restored")`
  4. **é‡å»º GraphState**
     - åœæ­¢å½“å‰å·¥ä½œæµ
     - è°ƒç”¨ `initialize_project()` ä»ç£ç›˜æ–‡ä»¶é‡å»ºçŠ¶æ€
     - æ›´æ–°æ—¥å¿—ï¼š`RecoveryLogService.update_phase("state_rebuilt")`
  5. **æ¸…ç†**
     - è°ƒç”¨ `SnapshotService.pop_snapshot()` åˆ é™¤å½“å‰å¿«ç…§ï¼ˆå·²è¢«æ¢å¤çš„å¿«ç…§æ›¿ä»£ï¼‰
     - è°ƒç”¨ `RecoveryLogService.delete_log()` åˆ é™¤æ¢å¤æ—¥å¿—
  6. **æ¢å¤å·¥ä½œæµ**
     - å‘å¸ƒ `EVENT_SNAPSHOT_RESTORED` äº‹ä»¶
     - åˆ·æ–°æ‰€æœ‰ UI é¢æ¿ï¼ˆç¼–è¾‘å™¨é‡æ–°åŠ è½½æ–‡ä»¶å†…å®¹ï¼‰
     - è¿”å› `user_checkpoint_node`ï¼ˆè®©ç”¨æˆ·ç»§ç»­é€‰æ‹©ä¸‹ä¸€æ­¥ï¼‰
- [ ] **çº¿æ€§æ’¤å›ä¼˜åŠ¿**ï¼š
  - ç®€å•å¯é ï¼Œæ— åˆ†æ”¯å†å²
  - æ–‡ä»¶å¿«ç…§ä¸ºå”¯ä¸€çœŸç†æ¥æº
  - GraphState ä»ç£ç›˜é‡å»ºï¼Œä¿è¯ä¸€è‡´æ€§
  - WAL æ—¥å¿—ä¿éšœå´©æºƒæ¢å¤
- [ ] **é”™è¯¯å¤„ç†**ï¼š
  - é¢„æ£€æŸ¥å¤±è´¥ï¼šæ˜¾ç¤ºæç¤ºä¿¡æ¯ï¼Œä¸æ‰§è¡Œæ’¤å›
  - å¿«ç…§æ¢å¤å¤±è´¥ï¼šè®°å½•é”™è¯¯åˆ°æ¢å¤æ—¥å¿—ï¼Œé€šçŸ¥ç”¨æˆ·
  - çŠ¶æ€é‡å»ºå¤±è´¥ï¼šæ¢å¤æ—¥å¿—ä¿ç•™ï¼Œä¸‹æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨æ¢å¤
- [ ] **æ³¨æ„äº‹é¡¹**ï¼š
  - æ’¤å›æ“ä½œä¼šè¦†ç›–ç”¨æˆ·åœ¨å½“å‰è¿­ä»£ä¸­çš„æ‰€æœ‰æ‰‹åŠ¨ç¼–è¾‘
  - æ’¤å›å‰åº”æç¤ºç”¨æˆ·ç¡®è®¤
  - åªæ”¯æŒæ’¤å›åˆ°ä¸Šä¸€ä¸ªè¿­ä»£ï¼ˆçº¿æ€§æ’¤å›ï¼Œä¸æ”¯æŒè·³è·ƒï¼‰
- [ ] **ä¾èµ–æ¨¡å—**ï¼š
  - `SnapshotService` - å…¨é‡å¿«ç…§æœåŠ¡ï¼ˆé˜¶æ®µ 2.5ï¼‰
  - `RecoveryLogService` - WAL æ¢å¤æ—¥å¿—æœåŠ¡ï¼ˆé˜¶æ®µ 2.5ï¼‰
- [ ] **è¾“å‡º**ï¼šæ¢å¤åçš„ GraphState

#### 8.7.3 å•æ“ä½œæ’¤é”€æœºåˆ¶

> **è®¾è®¡ç†å¿µ**ï¼šé™¤äº†æ•´ä½“è¿­ä»£æ’¤å›å¤–ï¼Œç”¨æˆ·è¿˜å¯ä»¥æ’¤é”€å•ä¸ªæ–‡ä»¶æ“ä½œã€‚è¿™æä¾›äº†æ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼Œè®©ç”¨æˆ·å¯ä»¥ä¿ç•™éƒ¨åˆ†ä¿®æ”¹è€Œåªæ’¤é”€ç‰¹å®šæ“ä½œã€‚

> **ä¸è¿­ä»£æ’¤å›çš„åŒºåˆ«**ï¼š
> - **è¿­ä»£æ’¤å›**ï¼ˆ`undo_node`ï¼‰ï¼šé€šè¿‡ SnapshotService æ¢å¤åˆ°ä¸Šä¸€ä¸ªå®Œæ•´è¿­ä»£æ£€æŸ¥ç‚¹ï¼Œæ’¤é”€è¯¥è¿­ä»£å†…çš„æ‰€æœ‰ä¿®æ”¹
> - **å•æ“ä½œæ’¤é”€**ï¼ˆ`OperationRecorder.undo_operation`ï¼‰ï¼šä»…æ’¤é”€å•ä¸ªæ–‡ä»¶æ“ä½œï¼Œä¿ç•™å…¶ä»–ä¿®æ”¹

##### å•æ“ä½œæ’¤é”€æµç¨‹

- [ ] **è§¦å‘æ–¹å¼**ï¼šç”¨æˆ·åœ¨æ“ä½œå¡ç‰‡ä¸Šç‚¹å‡»"æ’¤é”€"æŒ‰é’®
- [ ] **æ‰§è¡Œæµç¨‹**ï¼š
  1. ä» `OperationRecorder` è·å–æ“ä½œè¯¦æƒ…å’Œå¤‡ä»½è·¯å¾„
  2. æ ¡éªŒæ“ä½œæ˜¯å¦æ”¯æŒæ’¤é”€ï¼ˆ`can_undo = True`ï¼‰
  3. æ ¡éªŒå¤‡ä»½æ–‡ä»¶æ˜¯å¦å­˜åœ¨
  4. è¯»å–å¤‡ä»½æ–‡ä»¶å†…å®¹
  5. æ¢å¤åŸæ–‡ä»¶å†…å®¹ï¼ˆè¦†ç›–å½“å‰æ–‡ä»¶ï¼‰
  6. æ›´æ–°æ“ä½œçŠ¶æ€ä¸º `undone`
  7. å‘å¸ƒ `EVENT_OPERATION_UNDONE` äº‹ä»¶
  8. åˆ é™¤å¤‡ä»½æ–‡ä»¶
  9. åˆ·æ–°ä»£ç ç¼–è¾‘å™¨æ˜¾ç¤º
- [ ] **æ’¤é”€å¤±è´¥å¤„ç†**ï¼š
  - å¤‡ä»½æ–‡ä»¶ä¸å­˜åœ¨ï¼šæ˜¾ç¤ºé”™è¯¯æç¤º"æ— æ³•æ’¤é”€ï¼šå¤‡ä»½æ–‡ä»¶å·²ä¸¢å¤±"
  - æ–‡ä»¶å†™å…¥å¤±è´¥ï¼šæ˜¾ç¤ºé”™è¯¯æç¤ºï¼Œä¿ç•™å¤‡ä»½æ–‡ä»¶
  - æ“ä½œä¸æ”¯æŒæ’¤é”€ï¼šæŒ‰é’®åº”å·²ç¦ç”¨ï¼Œä¸åº”è§¦å‘æ­¤æµç¨‹

##### æ’¤é”€ç¡®è®¤æœºåˆ¶

- [ ] **ç¡®è®¤å¯¹è¯æ¡†**ï¼ˆå¯é€‰ï¼Œé€šè¿‡é…ç½®å¼€å…³æ§åˆ¶ï¼‰ï¼š
  - æ ‡é¢˜ï¼š"ç¡®è®¤æ’¤é”€æ“ä½œ"
  - å†…å®¹ï¼š"ç¡®å®šè¦æ’¤é”€å¯¹ {file_path} çš„ä¿®æ”¹å—ï¼Ÿæ­¤æ“ä½œå°†æ¢å¤æ–‡ä»¶åˆ°ä¿®æ”¹å‰çš„çŠ¶æ€ã€‚"
  - æŒ‰é’®ï¼š"ç¡®è®¤æ’¤é”€"ã€"å–æ¶ˆ"
- [ ] **é»˜è®¤è¡Œä¸º**ï¼šç›´æ¥æ’¤é”€ï¼Œä¸å¼¹å‡ºç¡®è®¤å¯¹è¯æ¡†ï¼ˆæé«˜æ“ä½œæ•ˆç‡ï¼‰
- [ ] **é…ç½®é¡¹**ï¼š`confirm_before_undo`ï¼ˆé»˜è®¤ Falseï¼‰

##### æ’¤é”€åçš„çŠ¶æ€åŒæ­¥

- [ ] **UI æ›´æ–°**ï¼š
  - æ“ä½œå¡ç‰‡çŠ¶æ€å›¾æ ‡å˜ä¸ºå·²æ’¤é”€ï¼ˆç°è‰²å›é€€ç®­å¤´ï¼‰
  - æ’¤é”€æŒ‰é’®ç¦ç”¨
  - æ“ä½œæ‘˜è¦æ–‡æœ¬æ·»åŠ "ï¼ˆå·²æ’¤é”€ï¼‰"åç¼€
- [ ] **ç¼–è¾‘å™¨æ›´æ–°**ï¼š
  - è‹¥æ’¤é”€çš„æ–‡ä»¶å½“å‰åœ¨ç¼–è¾‘å™¨ä¸­æ‰“å¼€ï¼Œè‡ªåŠ¨é‡æ–°åŠ è½½æ–‡ä»¶å†…å®¹
  - å‘å¸ƒ `EVENT_FILE_CONTENT_CHANGED` äº‹ä»¶é€šçŸ¥ç¼–è¾‘å™¨
- [ ] **GraphState æ›´æ–°**ï¼š
  - å•æ“ä½œæ’¤é”€ä¸å½±å“ GraphState ä¸­çš„è¿­ä»£çŠ¶æ€
  - ä»…æ›´æ–° `OperationRecorder` ä¸­çš„æ“ä½œè®°å½•

##### æ’¤é”€é™åˆ¶

- [ ] **æ—¶é—´é™åˆ¶**ï¼šæ“ä½œå®Œæˆå 24 å°æ—¶å†…å¯æ’¤é”€ï¼Œè¶…æ—¶åå¤‡ä»½æ–‡ä»¶è‡ªåŠ¨æ¸…ç†
- [ ] **é¡ºåºé™åˆ¶**ï¼šæ— é¡ºåºé™åˆ¶ï¼Œå¯ä»¥æ’¤é”€ä»»æ„å•ä¸ªæ“ä½œï¼ˆä¸è¦æ±‚æŒ‰é€†åºæ’¤é”€ï¼‰
- [ ] **é‡å¤æ’¤é”€**ï¼šå·²æ’¤é”€çš„æ“ä½œä¸èƒ½å†æ¬¡æ’¤é”€
- [ ] **æ’¤é”€åé‡åš**ï¼šæš‚ä¸æ”¯æŒé‡åšåŠŸèƒ½ï¼ˆå¯åœ¨åç»­ç‰ˆæœ¬æ·»åŠ ï¼‰

#### 8.7.4 å¯åŠ¨æ—¶å´©æºƒæ¢å¤æ£€æŸ¥

> **è®¾è®¡ç†å¿µ**ï¼šå¤„ç†æ’¤å›æ“ä½œä¸­é€”å´©æºƒçš„åœºæ™¯ï¼Œç¡®ä¿æœ€ç»ˆä¸€è‡´æ€§ã€‚åœ¨åº”ç”¨å¯åŠ¨æ—¶æ£€æµ‹æœªå®Œæˆçš„æ¢å¤æ“ä½œã€‚

##### 8.7.4.1 å´©æºƒæ¢å¤æ£€æŸ¥æµç¨‹

- [ ] **æ£€æŸ¥æ—¶æœº**ï¼š`bootstrap.py` çš„ `initialize_project()` ä¸­
- [ ] **æ£€æŸ¥é€»è¾‘**ï¼š
  1. è°ƒç”¨ `RecoveryLogService.has_pending_recovery(project_root)`
  2. è‹¥è¿”å› Falseï¼Œæ­£å¸¸å¯åŠ¨
  3. è‹¥è¿”å› Trueï¼Œè¯»å–æ¢å¤æ—¥å¿—å¹¶æ ¹æ® phase å¤„ç†
- [ ] **phase å¤„ç†ç­–ç•¥**ï¼š
  - `phase = "files_restored"`ï¼šæ–‡ä»¶å·²æ¢å¤ï¼ŒçŠ¶æ€æœªé‡å»º
    - é™é»˜å®ŒæˆçŠ¶æ€é‡å»ºï¼ˆè°ƒç”¨ `initialize_project` çš„æ­£å¸¸é€»è¾‘å³å¯ï¼‰
    - åˆ é™¤æ¢å¤æ—¥å¿—
    - æ˜¾ç¤ºé€šçŸ¥ï¼š"æ£€æµ‹åˆ°ä¸Šæ¬¡æ’¤å›æ“ä½œæœªå®Œæˆï¼Œå·²è‡ªåŠ¨æ¢å¤åˆ°è¿­ä»£ N"
  - `phase = "started"`ï¼šæ¢å¤åˆšå¼€å§‹å°±å¤±è´¥ï¼Œæ–‡ä»¶å¯èƒ½ä¸ä¸€è‡´
    - å¼¹å‡ºæ¨¡æ€å¯¹è¯æ¡†è®©ç”¨æˆ·é€‰æ‹©
    - é€‰é¡¹ 1ï¼š"ä»å¤‡ä»½æ¢å¤" - æ¢å¤åˆ°æ’¤å›å‰çš„çŠ¶æ€
    - é€‰é¡¹ 2ï¼š"ä¿æŒç°çŠ¶" - ä¿ç•™å½“å‰æ–‡ä»¶ï¼Œè®©ç”¨æˆ·æ‰‹åŠ¨æ£€æŸ¥
    - æ— è®ºé€‰æ‹©å“ªä¸ªï¼Œéƒ½åˆ é™¤æ¢å¤æ—¥å¿—
  - `phase = "state_rebuilt"`ï¼šçŠ¶æ€å·²é‡å»ºï¼Œå³å°†å®Œæˆ
    - é™é»˜åˆ é™¤æ¢å¤æ—¥å¿—
    - æ­£å¸¸å¯åŠ¨

##### 8.7.4.2 å´©æºƒæ¢å¤å¯¹è¯æ¡†

- [ ] **æ–‡ä»¶è·¯å¾„**ï¼š`presentation/dialogs/recovery_dialog.py`
- [ ] **èŒè´£**ï¼šåœ¨æ£€æµ‹åˆ°å´©æºƒåçš„ä¸ä¸€è‡´çŠ¶æ€æ—¶ï¼Œè®©ç”¨æˆ·é€‰æ‹©æ¢å¤ç­–ç•¥
- [ ] **å¯¹è¯æ¡†å†…å®¹**ï¼š
  - æ ‡é¢˜ï¼š"æ£€æµ‹åˆ°æœªå®Œæˆçš„æ’¤å›æ“ä½œ"
  - è¯´æ˜æ–‡æœ¬ï¼š"ä¸Šæ¬¡æ’¤å›æ“ä½œåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­è¢«ä¸­æ–­ï¼Œæ–‡ä»¶å¯èƒ½å¤„äºä¸ä¸€è‡´çŠ¶æ€ã€‚"
  - é€‰é¡¹æŒ‰é’®ï¼š
    - "ä»å¤‡ä»½æ¢å¤"ï¼ˆæ¨èï¼‰- æ¢å¤åˆ°æ’¤å›å‰çš„çŠ¶æ€
    - "ä¿æŒç°çŠ¶" - ä¿ç•™å½“å‰æ–‡ä»¶ï¼Œæ‰‹åŠ¨æ£€æŸ¥
- [ ] **è¿”å›å€¼**ï¼šç”¨æˆ·é€‰æ‹©çš„æ¢å¤ç­–ç•¥

##### 8.7.4.3 `bootstrap.py` é›†æˆ

- [ ] **ä¿®æ”¹ä½ç½®**ï¼š`application/bootstrap.py` çš„ `initialize_project()` æ–¹æ³•
- [ ] **æ–°å¢é€»è¾‘**ï¼š
  ```
  def initialize_project(project_root):
      # 1. æ£€æŸ¥å´©æºƒæ¢å¤
      if RecoveryLogService.has_pending_recovery(project_root):
          _handle_pending_recovery(project_root)
      
      # 2. æ­£å¸¸åˆå§‹åŒ–é€»è¾‘...
  ```
- [ ] **ä¾èµ–æ¨¡å—**ï¼š
  - `RecoveryLogService` - WAL æ¢å¤æ—¥å¿—æœåŠ¡
  - `RecoveryDialog` - å´©æºƒæ¢å¤å¯¹è¯æ¡†ï¼ˆä»…åœ¨éœ€è¦ç”¨æˆ·é€‰æ‹©æ—¶ï¼‰

---

### 8.8 å»ºè®®é€‰é¡¹æ¶ˆæ¯ UI ç»„ä»¶

#### 8.8.1 `suggestion_message.py` - å»ºè®®é€‰é¡¹æ¶ˆæ¯ç»„ä»¶

- [ ] **æ–‡ä»¶è·¯å¾„**ï¼š`presentation/panels/conversation/suggestion_message.py`
- [ ] **èŒè´£**ï¼šåœ¨å¯¹è¯å†å²åŒºæ˜¾ç¤ºå»ºè®®é€‰é¡¹æ¶ˆæ¯
- [ ] **è§†è§‰è®¾è®¡**ï¼š
  - æ¶ˆæ¯èƒŒæ™¯ï¼šæµ…è“è‰²ï¼ˆ`#e3f2fd`ï¼‰
  - çŠ¶æ€æ‘˜è¦åŒºï¼šæ˜¾ç¤ºå½“å‰è¿­ä»£çŠ¶æ€
  - æŒ‰é’®ç»„ï¼šæ¨ªå‘æ’åˆ—çš„å»ºè®®æŒ‰é’®
  - ä¸»è¦å»ºè®®æŒ‰é’®é«˜äº®æ˜¾ç¤º
  - ç¦ç”¨æŒ‰é’®ç°è‰²æ˜¾ç¤º
- [ ] **æŒ‰é’®çŠ¶æ€**ï¼š
  - å¯ç”¨çŠ¶æ€ï¼šæ­£å¸¸é¢œè‰²ï¼Œå¯ç‚¹å‡»
  - å·²é€‰æ‹©çŠ¶æ€ï¼šé«˜äº®è¾¹æ¡†ï¼Œç¦ç”¨ç‚¹å‡»
  - è¿‡æœŸçŠ¶æ€ï¼šç°è‰²ï¼Œç¦ç”¨ç‚¹å‡»
- [ ] **äº¤äº’**ï¼š
  - ç‚¹å‡»æŒ‰é’® â†’ å‘é€å¯¹åº”æ„å›¾åˆ°å·¥ä½œæµ
  - æŒ‰é’®ç‚¹å‡»åå˜ä¸ºå·²é€‰æ‹©çŠ¶æ€
  - ç”¨æˆ·é€šè¿‡è¾“å…¥æ¡†å‘é€æ¶ˆæ¯åï¼ŒæŒ‰é’®å˜ä¸ºè¿‡æœŸçŠ¶æ€
- [ ] **å›½é™…åŒ–æ”¯æŒ**ï¼šå®ç° `retranslate_ui()` æ–¹æ³•

---

### 8.9 å·¥ä½œæµç¼–æ’æ¨¡å—ç»„ (`application/workflow/`)

> **ç›®å½•ç»“æ„**ï¼š
> ```
> application/workflow/
> â”œâ”€â”€ __init__.py
> â”œâ”€â”€ design_workflow.py         # é—¨é¢ç±»ï¼Œåè°ƒå„å­æ¨¡å—
> â”œâ”€â”€ workflow_lifecycle.py      # æµç¨‹ç”Ÿå‘½å‘¨æœŸç®¡ç†
> â”œâ”€â”€ user_input_handler.py      # ç”¨æˆ·è¾“å…¥å¤„ç†
> â”œâ”€â”€ stream_event_dispatcher.py # æµå¼äº‹ä»¶åˆ†å‘
> â”œâ”€â”€ iteration_sync_handler.py  # è¿­ä»£åŒæ­¥å¤„ç†
> â””â”€â”€ auxiliary_task_handler.py  # è¾…åŠ©ä»»åŠ¡å¤„ç†
> ```

> **å•ä¸€èŒè´£æ‹†åˆ†**ï¼šä¸ºé¿å…å•ä¸ªç¼–æ’å™¨èŒè´£è¿‡é‡ï¼Œå°†å·¥ä½œæµç¼–æ’åŠŸèƒ½æ‹†åˆ†ä¸ºå¤šä¸ªåä½œæ¨¡å—

> **åˆå§‹åŒ–é¡ºåº**ï¼šPhase 3.40ï¼Œä¾èµ– AsyncTaskRegistryã€EventBusã€SessionStateã€GraphStateProjectorã€æ‰€æœ‰å›¾èŠ‚ç‚¹ï¼Œæ³¨å†Œåˆ° ServiceLocator

#### 8.9.1 `design_workflow.py` - å·¥ä½œæµç¼–æ’é—¨é¢ç±»

- [ ] **æ–‡ä»¶è·¯å¾„**ï¼š`application/workflow/design_workflow.py`
- [ ] **èŒè´£**ï¼šä½œä¸ºå·¥ä½œæµç¼–æ’çš„ç»Ÿä¸€å…¥å£ï¼Œåè°ƒå„å­æ¨¡å—å®Œæˆè®¾è®¡æµç¨‹
- [ ] **æ ¸å¿ƒåŠŸèƒ½**ï¼š
  - `start_design_flow(user_requirement)` - å¯åŠ¨è®¾è®¡æµç¨‹ï¼ˆå§”æ‰˜ç»™ `WorkflowLifecycle`ï¼‰
  - `resume_flow(thread_id)` - æ¢å¤æš‚åœçš„æµç¨‹ï¼ˆå§”æ‰˜ç»™ `WorkflowLifecycle`ï¼‰
  - `stop_flow()` - åœæ­¢å½“å‰æµç¨‹ï¼ˆå§”æ‰˜ç»™ `WorkflowLifecycle`ï¼‰
  - `handle_user_input(message)` - å¤„ç†ç”¨æˆ·è¾“å…¥ï¼ˆå§”æ‰˜ç»™ `UserInputHandler`ï¼‰
  - `handle_undo_request()` - å¤„ç†æ’¤å›è¯·æ±‚ï¼ˆå§”æ‰˜ç»™ `UserInputHandler`ï¼‰
  - `trigger_simulation()` - æ‰‹åŠ¨è§¦å‘ä»¿çœŸï¼ˆå§”æ‰˜ç»™ `AuxiliaryTaskHandler`ï¼‰
  - `trigger_rag_index(folder_path)` - è§¦å‘RAGç´¢å¼•ï¼ˆå§”æ‰˜ç»™ `AuxiliaryTaskHandler`ï¼‰
- [ ] **ä¾èµ–æ¨¡å—**ï¼š
  - `WorkflowLifecycle` - æµç¨‹ç”Ÿå‘½å‘¨æœŸç®¡ç†
  - `UserInputHandler` - ç”¨æˆ·è¾“å…¥å¤„ç†
  - `StreamEventDispatcher` - æµå¼äº‹ä»¶åˆ†å‘
  - `IterationSyncHandler` - è¿­ä»£åŒæ­¥å¤„ç†
  - `AuxiliaryTaskHandler` - è¾…åŠ©ä»»åŠ¡å¤„ç†
- [ ] **æ¸è¿›å¼å¤æ‚åº¦**ï¼šå…ˆå®ç°æ ¸å¿ƒæµç¨‹ï¼ˆè®¾è®¡â†’ä»¿çœŸâ†’åˆ†æâ†’ä¼˜åŒ–ï¼‰ï¼ŒRAG å’Œè”ç½‘æœç´¢ç­‰å¢å¼ºåŠŸèƒ½é€šè¿‡é…ç½®å¼€å…³æ§åˆ¶
- [ ] **è¢«è°ƒç”¨æ–¹**ï¼š`main_window.py`ï¼ˆç”¨æˆ·æ“ä½œï¼‰ã€å„é¢æ¿ï¼ˆäº‹ä»¶æ´¾å‘ï¼‰

#### 8.9.2 `workflow_lifecycle.py` - æµç¨‹ç”Ÿå‘½å‘¨æœŸç®¡ç†å™¨

- [ ] **æ–‡ä»¶è·¯å¾„**ï¼š`application/workflow/workflow_lifecycle.py`
- [ ] **èŒè´£**ï¼šä¸“æ³¨äºç®¡ç†å·¥ä½œæµçš„å¯åŠ¨ã€æ¢å¤ã€åœæ­¢ç­‰ç”Ÿå‘½å‘¨æœŸæ“ä½œ
- [ ] **æ ¸å¿ƒåŠŸèƒ½**ï¼š
  - `start(user_requirement)` - å¯åŠ¨è®¾è®¡æµç¨‹
  - `resume(thread_id)` - æ¢å¤æš‚åœçš„æµç¨‹
  - `stop()` - åœæ­¢å½“å‰æµç¨‹
  - `get_current_state()` - è·å–å½“å‰æµç¨‹çŠ¶æ€
  - `is_running()` - æ£€æŸ¥æµç¨‹æ˜¯å¦æ­£åœ¨è¿è¡Œ
- [ ] **æµç¨‹å¯åŠ¨é€»è¾‘**ï¼š
  1. æ ¡éªŒå·¥ä½œæ–‡ä»¶å¤¹å·²åˆå§‹åŒ–
  2. åˆ›å»ºåˆå§‹ `GraphState`
  3. è°ƒç”¨ `builder.compile_graph()` è·å–ç¼–è¯‘åçš„å›¾
  4. é€šè¿‡ `runtime.execute_graph()` å¯åŠ¨æ‰§è¡Œ
- [ ] **æµç¨‹æ¢å¤é€»è¾‘**ï¼š
  - **âš ï¸ æ–°å†™æ³•**ï¼šä½¿ç”¨ `from langgraph.types import Command`
  - è°ƒç”¨ `graph.invoke(Command(resume=value), config)` æ¢å¤æ‰§è¡Œ
- [ ] **æµç¨‹åœæ­¢é€»è¾‘**ï¼š
  - å‘é€åœæ­¢ä¿¡å·ç»™å½“å‰æ‰§è¡Œçš„å›¾
  - ç­‰å¾…å½“å‰èŠ‚ç‚¹æ‰§è¡Œå®Œæˆ
  - ä¿å­˜å½“å‰çŠ¶æ€åˆ°æ£€æŸ¥ç‚¹
- [ ] **è¢«è°ƒç”¨æ–¹**ï¼š`design_workflow.py`

#### 8.9.3 `user_input_handler.py` - ç”¨æˆ·è¾“å…¥å¤„ç†å™¨

- [ ] **æ–‡ä»¶è·¯å¾„**ï¼š`application/workflow/user_input_handler.py`
- [ ] **èŒè´£**ï¼šä¸“æ³¨äºå¤„ç†ç”¨æˆ·çš„å„ç§è¾“å…¥æ“ä½œï¼Œæ ¹æ®å¯¹è¯æ¨¡å¼è·¯ç”±åˆ°ä¸åŒå¤„ç†æµç¨‹
- [ ] **æ ¸å¿ƒåŠŸèƒ½**ï¼š
  - `handle_message(message)` - å¤„ç†ç”¨æˆ·å‘é€çš„æ¶ˆæ¯ï¼ˆå…¥å£æ–¹æ³•ï¼‰
  - `handle_suggestion_click(suggestion_id)` - å¤„ç†å»ºè®®æŒ‰é’®ç‚¹å‡»
  - `handle_undo_request()` - å¤„ç†æ’¤å›è¯·æ±‚
  - `handle_file_selection(file_paths)` - å¤„ç†æ–‡ä»¶é€‰æ‹©
  - `_route_by_work_mode(message)` - æ ¹æ®å·¥ä½œæ¨¡å¼è·¯ç”±æ¶ˆæ¯
- [ ] **å·¥ä½œæ¨¡å¼è·¯ç”±é€»è¾‘**ï¼š
  1. è·å–å½“å‰å·¥ä½œæ¨¡å¼ï¼š`mode = SessionStateManager.get_work_mode()`
  2. è‹¥ `mode == FREE_WORK`ï¼šç›´æ¥è°ƒç”¨ `_handle_free_work_message(message)`
  3. è‹¥ `mode == WORKFLOW`ï¼šè°ƒç”¨ `_handle_workflow_message(message)`
- [ ] **è¿­ä»£ç¡®è®¤å¤„ç†**ï¼š
  - è®¢é˜… `ITERATION_USER_CONFIRMED` äº‹ä»¶
  - æ”¶åˆ°äº‹ä»¶åé€šçŸ¥ `WorkflowLifecycle` æ¢å¤æ‰§è¡Œ
  - è®¢é˜… `ITERATION_USER_STOPPED` äº‹ä»¶
  - æ”¶åˆ°äº‹ä»¶åé€šçŸ¥ `WorkflowLifecycle` åœæ­¢æµç¨‹
- [ ] **æ’¤å›æ“ä½œå¤„ç†**ï¼š
  - è°ƒç”¨ `undo_manager.restore_snapshot()`
  - åŒæ­¥æ›´æ–° Checkpointer çŠ¶æ€
  - å‘å¸ƒäº‹ä»¶é€šçŸ¥ UI åˆ·æ–°
- [ ] **è¢«è°ƒç”¨æ–¹**ï¼š`design_workflow.py`

#### 8.9.4 `stream_event_dispatcher.py` - æµå¼äº‹ä»¶åˆ†å‘å™¨

- [ ] **æ–‡ä»¶è·¯å¾„**ï¼š`application/workflow/stream_event_dispatcher.py`
- [ ] **èŒè´£**ï¼šä¸“æ³¨äºå¤„ç†å’Œåˆ†å‘æµå¼è¾“å‡ºäº‹ä»¶
- [ ] **æ ¸å¿ƒåŠŸèƒ½**ï¼š
  - `dispatch(event)` - åˆ†å‘æµå¼äº‹ä»¶
  - `register_handler(event_type, handler)` - æ³¨å†Œäº‹ä»¶å¤„ç†å™¨
  - `start_listening()` - å¼€å§‹ç›‘å¬æµå¼äº‹ä»¶
  - `stop_listening()` - åœæ­¢ç›‘å¬
- [ ] **äº‹ä»¶åˆ†å‘é€»è¾‘**ï¼š
  - æ¥æ”¶ `runtime` çš„æµå¼äº‹ä»¶
  - å°† `llm_chunk` äº‹ä»¶è½¬å‘ç»™ `conversation_panel`
  - å°† `state_update` äº‹ä»¶è½¬å‘ç»™ç›¸åº”é¢æ¿
  - å°† `tool_call` äº‹ä»¶è½¬å‘ç»™æ“ä½œè®°å½•å™¨
- [ ] **äº‹ä»¶ç±»å‹æ˜ å°„**ï¼š
  - `llm_chunk` â†’ `conversation_panel`ï¼ˆæµå¼æ˜¾ç¤ºï¼‰
  - `state_update` â†’ å„é¢æ¿ï¼ˆçŠ¶æ€æ›´æ–°ï¼‰
  - `node_start` â†’ çŠ¶æ€æ ï¼ˆæ˜¾ç¤ºå½“å‰èŠ‚ç‚¹ï¼‰
  - `node_end` â†’ çŠ¶æ€æ ï¼ˆæ›´æ–°è¿›åº¦ï¼‰
- [ ] **è¢«è°ƒç”¨æ–¹**ï¼š`design_workflow.py`

#### 8.9.5 `iteration_sync_handler.py` - è¿­ä»£åŒæ­¥å¤„ç†å™¨

- [ ] **æ–‡ä»¶è·¯å¾„**ï¼š`application/workflow/iteration_sync_handler.py`
- [ ] **èŒè´£**ï¼šä¸“æ³¨äºå¤„ç†è¿­ä»£å®Œæˆåçš„åŒæ­¥é€»è¾‘
- [ ] **æ ¸å¿ƒåŠŸèƒ½**ï¼š
  - `on_iteration_complete(state)` - è¿­ä»£å®Œæˆæ—¶çš„å¤„ç†
  - `wait_for_ui_sync()` - ç­‰å¾…UIé¢æ¿åŒæ­¥å®Œæˆ
  - `check_termination_condition(state)` - æ£€æŸ¥ç»ˆæ­¢æ¡ä»¶
- [ ] **è¿­ä»£åŒæ­¥æœºåˆ¶**ï¼š
  - æ¯è½®è¿­ä»£å®Œæˆåï¼Œå‘å¸ƒ `EVENT_STATE_ITERATION_UPDATED` äº‹ä»¶
  - å„é¢æ¿è®¢é˜…äº‹ä»¶å¹¶å¼‚æ­¥æ›´æ–°
  - ä½¿ç”¨çŸ­æš‚å»¶è¿Ÿï¼ˆ100-200msï¼‰ç¡®ä¿UIæœ‰è¶³å¤Ÿæ—¶é—´å“åº”
  - å»¶è¿Ÿåå†æ£€æŸ¥ç»ˆæ­¢æ¡ä»¶ï¼Œå†³å®šæ˜¯å¦ç»§ç»­ä¸‹ä¸€è½®
  - é¿å…"ä¸‹ä¸€è½®å·²å¼€å§‹ä½†ä¸Šä¸€è½®UIè¿˜æœªæ›´æ–°å®Œ"çš„ä¸ä¸€è‡´çŠ¶æ€
- [ ] **è¢«è°ƒç”¨æ–¹**ï¼š`design_workflow.py`

#### 8.9.6 `auxiliary_task_handler.py` - è¾…åŠ©ä»»åŠ¡å¤„ç†å™¨

- [ ] **æ–‡ä»¶è·¯å¾„**ï¼š`application/workflow/auxiliary_task_handler.py`
- [ ] **èŒè´£**ï¼šä¸“æ³¨äºå¤„ç†ä¸é˜»å¡ä¸»æµç¨‹çš„è¾…åŠ©ä»»åŠ¡
- [ ] **æ ¸å¿ƒåŠŸèƒ½**ï¼š
  - `trigger_simulation()` - æ‰‹åŠ¨è§¦å‘ä»¿çœŸ
  - `trigger_rag_index(folder_path)` - è§¦å‘RAGç´¢å¼•
  - `trigger_web_search(query)` - è§¦å‘è”ç½‘æœç´¢
  - `trigger_data_inspection(config)` - è§¦å‘æ•°æ®æ£€æŸ¥
  - `trigger_code_index_update(changed_files)` - è§¦å‘ä»£ç ç´¢å¼•æ›´æ–°
- [ ] **è°ƒåº¦ç­–ç•¥**ï¼š
  - åŒç±»ä»»åŠ¡äº’æ–¥æ’é˜Ÿï¼ˆé¿å…é‡å¤ä»¿çœŸ/é‡å¤LLMè°ƒç”¨ï¼‰
  - å¼‚ç±»ä»»åŠ¡å¯å¹¶è¡Œï¼ˆä»¿çœŸä¸LLMå¯åŒæ—¶è¿›è¡Œï¼‰
- [ ] **ä»¿çœŸå¤±è´¥å¤„ç†**ï¼š
  - ä»¿çœŸå¤±è´¥æ—¶ä¸è‡ªåŠ¨å›æ»š
  - ä¿ç•™å½“å‰ä»£ç ä¸å‚æ•°æ”¹åŠ¨
  - è®°å½•å¤±è´¥åŸå› 
  - è¿›å…¥ `action_node` è¿›è¡Œä¿®æ­£
  - å›é€€ä»…åœ¨ç”¨æˆ·å‘èµ·"æ’¤å›"æ—¶æ‰§è¡Œ
- [ ] **è¢«è°ƒç”¨æ–¹**ï¼š`design_workflow.py`



---

### 8.10 é˜¶æ®µæ£€æŸ¥ç‚¹

#### 8.10.1 åŠŸèƒ½éªŒè¯æ£€æŸ¥é¡¹

- [ ] å»ºè®®é€‰é¡¹èƒ½æ ¹æ®çŠ¶æ€æ­£ç¡®ç”Ÿæˆ
- [ ] å„è¡ŒåŠ¨å¤„ç†å™¨èƒ½æ­£ç¡®æ‰§è¡Œå¯¹åº”æ“ä½œ
- [ ] è‡ªç”±è¾“å…¥èƒ½æ­£ç¡®ç”± LLM å¤„ç†å¹¶å†³å®šå“åº”æ–¹å¼
- [ ] æ’¤å›èŠ‚ç‚¹èƒ½æ­£ç¡®æ¢å¤å¿«ç…§ï¼ˆä½¿ç”¨å…¨é‡å¿«ç…§æœºåˆ¶ï¼‰
- [ ] æ¥å—èŠ‚ç‚¹èƒ½æ­£ç¡®ä¿å­˜æ–‡ä»¶å’Œç”ŸæˆæŠ¥å‘Š

#### 8.10.2 é›†æˆéªŒè¯æ£€æŸ¥é¡¹

- [ ] æ£€æŸ¥ç‚¹èƒ½æ­£ç¡®æš‚åœå’Œæ¢å¤å·¥ä½œæµ
- [ ] å»ºè®®é€‰é¡¹æ¶ˆæ¯èƒ½æ­£ç¡®æ˜¾ç¤ºåœ¨å¯¹è¯é¢æ¿
- [ ] ç”¨æˆ·ç‚¹å‡»æŒ‰é’®èƒ½æ­£ç¡®è§¦å‘å¯¹åº”æ“ä½œ
- [ ] ç”¨æˆ·è‡ªç”±è¾“å…¥èƒ½æ­£ç¡®è¿›å…¥ `action_node` å¤„ç†
- [ ] è®¾è®¡ç›®æ ‡ç¼–è¾‘å¯¹è¯æ¡†èƒ½æ­£ç¡®åŠ è½½å’Œä¿å­˜æ•°æ®
- [ ] SnapshotService æ­£ç¡®åˆ›å»ºå’Œæ¢å¤å…¨é‡å¿«ç…§

#### 8.10.3 è¡ŒåŠ¨å¤„ç†æ¨¡å—ç»„éªŒè¯

- [ ] `ActionNode` æ­£ç¡®å¤„ç†é¢„è®¾æŒ‰é’®å’Œè‡ªç”±è¾“å…¥
- [ ] `OptimizeAction` å‚æ•°ä¼˜åŒ–æµç¨‹æ­£å¸¸
- [ ] `FixErrorAction` æ­£ç¡®ä» `GraphState.last_simulation_error` è¯»å–é”™è¯¯ä¿¡æ¯ï¼ˆä¸é‡å¤è¿è¡Œä»¿çœŸï¼‰
- [ ] `ErrorContextBuilder` æ­£ç¡®æ„å»ºé”™è¯¯ä¸Šä¸‹æ–‡å’Œä»£ç ç‰‡æ®µ
- [ ] `ModifyGoalsAction` ç›®æ ‡ä¿®æ”¹å¯¹è¯æ¡†äº¤äº’æ­£å¸¸
- [ ] è‡ªç”±è¾“å…¥åæ ¹æ®å·¥å…·è°ƒç”¨æ­£ç¡®å†³å®šåç»­èŠ‚ç‚¹

#### 8.10.3.1 é”™è¯¯ä¿®å¤æµç¨‹éªŒè¯

- [ ] `FixErrorAction` åœ¨ `last_simulation_error` ä¸ºç©ºæ—¶è¿”å›æç¤ºä¿¡æ¯
- [ ] `ErrorContextBuilder` æ­£ç¡®æå–é”™è¯¯è¡Œé™„è¿‘ä»£ç ï¼ˆå‰åå„ 5 è¡Œï¼‰
- [ ] é”™è¯¯è¡Œä½¿ç”¨ `>>>` æ ‡è®°æ­£ç¡®é«˜äº®
- [ ] é”™è¯¯ç±»å‹ä¸ä¿®å¤å»ºè®®æ˜ å°„æ­£ç¡®
- [ ] ä¿®å¤å®Œæˆåæ­£ç¡®è¿›å…¥ `simulation_node` éªŒè¯

#### 8.10.3.2 é”™è¯¯ä¿®å¤ç†”æ–­æœºåˆ¶éªŒè¯

- [ ] `FixAttemptTracker.increment()` æ­£ç¡®å¢åŠ  `consecutive_fix_attempts` è®¡æ•°
- [ ] `FixAttemptTracker.reset()` åœ¨ä»¿çœŸæˆåŠŸæ—¶æ­£ç¡®é‡ç½®è®¡æ•°ä¸º 0
- [ ] `FixAttemptTracker.is_circuit_breaker_triggered()` åœ¨è¾¾åˆ°é˜ˆå€¼æ—¶è¿”å› True
- [ ] ç†”æ–­è§¦å‘å `FixErrorAction` ä¸æ‰§è¡Œ LLM è°ƒç”¨
- [ ] ç†”æ–­è§¦å‘åè¿”å›ç”¨æˆ·å‹å¥½çš„æç¤ºä¿¡æ¯
- [ ] ç†”æ–­çŠ¶æ€ä¸‹"ä¿®å¤é”™è¯¯"æŒ‰é’®æ­£ç¡®ç¦ç”¨
- [ ] ç†”æ–­çŠ¶æ€ä¸‹"ä¿®æ”¹ç›®æ ‡"æŒ‰é’®æ­£ç¡®é«˜äº®
- [ ] ç”¨æˆ·ä¿®æ”¹ç›®æ ‡å `consecutive_fix_attempts` æ­£ç¡®é‡ç½®
- [ ] ç”¨æˆ·æ‰§è¡Œæ’¤å›å `consecutive_fix_attempts` æ­£ç¡®é‡ç½®
- [ ] è‡ªç”±è¾“å…¥ä¿®å¤æˆåŠŸå `consecutive_fix_attempts` æ­£ç¡®é‡ç½®

#### 8.10.3.3 Agentic Loop é›†æˆéªŒè¯

- [ ] `ActionNode` é€šè¿‡ `AsyncTaskManager.submit()` æäº¤ Agentic Loop ä»»åŠ¡
- [ ] é¢„è®¾æŒ‰é’®ï¼ˆoptimize/fix_errorï¼‰è§¦å‘å¤šè½®å·¥å…·è°ƒç”¨æ­£å¸¸
- [ ] è‡ªç”±è¾“å…¥è§¦å‘å¤šè½®å·¥å…·è°ƒç”¨æ­£å¸¸
- [ ] æ¯æ¬¡ LLM è°ƒç”¨éƒ½æ˜¯ç‹¬ç«‹çš„ API è¯·æ±‚
- [ ] å·¥å…·æ‰§è¡Œç»“æœæ­£ç¡®æ ¼å¼åŒ–ä¸º tool æ¶ˆæ¯è¿”å›ç»™ LLM
- [ ] å¾ªç¯åœ¨ LLM è¿”å›æœ€ç»ˆå›å¤æ—¶æ­£ç¡®ç»ˆæ­¢
- [ ] å¾ªç¯è¾¾åˆ°æœ€å¤§è¿­ä»£æ¬¡æ•°æ—¶æ­£ç¡®ç»ˆæ­¢
- [ ] ç”¨æˆ·å–æ¶ˆæ“ä½œèƒ½æ­£ç¡®ä¸­æ–­å¾ªç¯
- [ ] å·¥å…·æ‰§è¡Œå¤±è´¥æ—¶ LLM èƒ½æ”¶åˆ°é”™è¯¯ä¿¡æ¯å¹¶å†³å®šä¸‹ä¸€æ­¥
- [ ] æµå¼è¾“å‡ºåœ¨å¤šè½®å¾ªç¯ä¸­æ­£å¸¸å·¥ä½œ
- [ ] `loop_state.tool_calls_history` æ­£ç¡®è®°å½•æ‰€æœ‰å·¥å…·è°ƒç”¨
- [ ] UI åœ¨ Agentic Loop æ‰§è¡ŒæœŸé—´ä¿æŒå“åº”ï¼ˆé€šè¿‡ await è®©å‡ºæ§åˆ¶æƒï¼‰
- [ ] æµå¼ chunk é€šè¿‡ pyqtSignal ç›´æ¥å‘é€ï¼ˆåŒçº¿ç¨‹ï¼Œæ— è·¨çº¿ç¨‹é€šä¿¡ï¼‰

#### 8.10.4 ç”¨æˆ·æ£€æŸ¥ç‚¹æ¨¡å—ç»„éªŒè¯

- [ ] `UserCheckpointNode` æ£€æŸ¥ç‚¹æš‚åœå’Œæ¢å¤æ­£å¸¸
- [ ] `SuggestionGenerator` å»ºè®®é€‰é¡¹å’ŒçŠ¶æ€æ‘˜è¦åŠ¨æ€ç”Ÿæˆæ­£ç¡®
- [ ] å¿«ç…§åˆ›å»ºä½¿ç”¨å…¨é‡æœºåˆ¶ï¼ˆè°ƒç”¨ SnapshotServiceï¼‰
- [ ] å¿«ç…§åˆ›å»ºæ—¶é—´åœ¨æ¯«ç§’çº§ï¼ˆä¸å¡ UIï¼‰

#### 8.10.5 å»ºè®®é€‰é¡¹æ¶ˆæ¯ç»„ä»¶éªŒè¯

- [ ] `SuggestionMessage` ç»„ä»¶æ­£ç¡®æ¸²æŸ“å»ºè®®é€‰é¡¹
- [ ] æ¶ˆæ¯åƒæ­£å¸¸æ¶ˆæ¯ä¸€æ ·æ˜¾ç¤ºåœ¨å¯¹è¯å†å²åŒº
- [ ] æŒ‰é’®ç‚¹å‡»åæ­£ç¡®å‘é€ä¿¡å·
- [ ] å·²é€‰æ‹©çŠ¶æ€å’Œè¿‡æœŸçŠ¶æ€æ­£ç¡®æ˜¾ç¤º

#### 8.10.6 å·¥ä½œæµç¼–æ’æ¨¡å—ç»„éªŒè¯

- [ ] `DesignWorkflow` é—¨é¢ç±»æ­£ç¡®åè°ƒå„å­æ¨¡å—
- [ ] `WorkflowLifecycle` æµç¨‹å¯åŠ¨/æ¢å¤/åœæ­¢æ­£å¸¸
- [ ] `UserInputHandler` ç”¨æˆ·è¾“å…¥å¤„ç†æ­£ç¡®
- [ ] `StreamEventDispatcher` æµå¼äº‹ä»¶åˆ†å‘æ­£å¸¸
- [ ] `IterationSyncHandler` è¿­ä»£åŒæ­¥æœºåˆ¶æ­£å¸¸
- [ ] `AuxiliaryTaskHandler` è¾…åŠ©ä»»åŠ¡å¤„ç†æ­£å¸¸

#### 8.10.7 è¿­ä»£ç¡®è®¤æœºåˆ¶éªŒè¯

- [ ] æ¯è½®è¿­ä»£å®Œæˆåæ­£å¸¸æš‚åœï¼Œå»ºè®®é€‰é¡¹æ¶ˆæ¯æ­£ç¡®è¿½åŠ åˆ°å¯¹è¯å†å²
- [ ] å»ºè®®é€‰é¡¹æ¶ˆæ¯åƒæ­£å¸¸æ¶ˆæ¯ä¸€æ ·æŠŠä¸Šé¢çš„å†…å®¹å‘ä¸Šé¡¶
- [ ] ç”¨æˆ·ç‚¹å‡»å»ºè®®æŒ‰é’®åï¼ŒæŒ‰é’®æ­£ç¡®å˜ä¸ºå·²é€‰æ‹©çŠ¶æ€
- [ ] ç”¨æˆ·é€šè¿‡è¾“å…¥æ¡†å‘é€æ¶ˆæ¯åï¼Œå»ºè®®æŒ‰é’®æ­£ç¡®å˜ä¸ºè¿‡æœŸçŠ¶æ€
- [ ] ç”¨æˆ·ç‚¹å‡»"ç»§ç»­ä¼˜åŒ–"åæ­£å¸¸ç»§ç»­
- [ ] ç”¨æˆ·ç‚¹å‡»"ä¿®å¤é”™è¯¯"åæ­£å¸¸æ‰§è¡Œé”™è¯¯ä¿®å¤æµç¨‹
- [ ] ç”¨æˆ·ç‚¹å‡»"ä¿®æ”¹ç›®æ ‡"åæ­£å¸¸å¼¹å‡ºç¼–è¾‘å¯¹è¯æ¡†
- [ ] ç”¨æˆ·ç‚¹å‡»"æ¥å—è®¾è®¡"åæ­£å¸¸ä¿å­˜å¹¶ç”ŸæˆæŠ¥å‘Š
- [ ] ç”¨æˆ·ç‚¹å‡»"åœæ­¢è®¾è®¡"åæ­£å¸¸ç»ˆæ­¢
- [ ] ç”¨æˆ·ç‚¹å‡»"æ’¤å›"åæ­£å¸¸æ¢å¤å¿«ç…§

#### 8.10.8 è‡ªç”±è¾“å…¥å¤„ç†éªŒè¯

- [ ] çº¯é—®é¢˜åœºæ™¯ï¼šLLM ä»…å›ç­”é—®é¢˜ï¼Œè¿”å›æ£€æŸ¥ç‚¹
- [ ] çº¯æŒ‡ä»¤åœºæ™¯ï¼šLLM è°ƒç”¨å·¥å…·æ‰§è¡Œæ“ä½œï¼Œè¿›å…¥ä»¿çœŸ
- [ ] æ··åˆåœºæ™¯ï¼šLLM å…ˆå›ç­”é—®é¢˜å†æ‰§è¡Œæ“ä½œï¼Œè¿›å…¥ä»¿çœŸ
- [ ] æ¨¡ç³Šåœºæ™¯ï¼šLLM ä¸»åŠ¨è¯¢é—®æ¾„æ¸…ï¼Œè¿”å›æ£€æŸ¥ç‚¹

#### 8.10.9 å·¥ä½œæµé”å®šæœºåˆ¶éªŒè¯

- [ ] å·¥ä½œæµè¿è¡Œä¸­ `workflow_locked = True`ï¼Œå±é™©æ“ä½œæ­£ç¡®ç¦ç”¨
- [ ] ç­‰å¾…ç”¨æˆ·ç¡®è®¤æ—¶ `workflow_locked = False`ï¼Œæ“ä½œæ­£ç¡®è§£é”
- [ ] é”å®šæ—¶ç¼–è¾‘å™¨åˆ‡æ¢ä¸ºåªè¯»æ¨¡å¼
- [ ] è¾“å…¥æ¡†å§‹ç»ˆå¯ç¼–è¾‘ï¼Œä»…å‘é€æŒ‰é’®æ ¹æ®é”å®šçŠ¶æ€å¯ç”¨/ç¦ç”¨
- [ ] æ£€æŸ¥ç‚¹æ—¶å‘é€æŒ‰é’®å¯ç”¨ï¼Œç”¨æˆ·å¯ä»¥å‘é€æ¶ˆæ¯
- [ ] çŠ¶æ€æ æ­£ç¡®æ˜¾ç¤ºé”å®šæç¤º
- [ ] **å¼‚å¸¸é€€å‡ºæ¢å¤**ï¼šç¨‹åºå¼‚å¸¸é€€å‡ºåé‡å¯ï¼Œé”å®šçŠ¶æ€è‡ªåŠ¨é‡ç½®ä¸º False

#### 8.10.10 æ–‡ä»¶æ“ä½œå±•ç¤ºéªŒè¯

- [ ] æ“ä½œå¡ç‰‡æ­£ç¡®æ˜¾ç¤ºåœ¨åŠ©æ‰‹æ¶ˆæ¯ä¸­
- [ ] æ“ä½œæ‘˜è¦æ–‡æœ¬æ­£ç¡®ç”Ÿæˆï¼ˆå¦‚"ä¿®æ”¹ amplifier.cirï¼ˆ+3 è¡Œï¼Œ-1 è¡Œï¼‰"ï¼‰
- [ ] æ–‡ä»¶ä¿®æ”¹æ“ä½œçš„ Diff è¯¦æƒ…å¯æ­£ç¡®å±•å¼€/æŠ˜å 
- [ ] Diff è§†å›¾æ­£ç¡®æ˜¾ç¤ºæ–°å¢è¡Œï¼ˆç»¿è‰²ï¼‰å’Œåˆ é™¤è¡Œï¼ˆçº¢è‰²ï¼‰
- [ ] "æŸ¥çœ‹æ–‡ä»¶"æŒ‰é’®æ­£ç¡®æ‰“å¼€ç¼–è¾‘å™¨å¹¶å®šä½åˆ°ä¿®æ”¹ä½ç½®
- [ ] æ“ä½œçŠ¶æ€å›¾æ ‡æ­£ç¡®æ˜¾ç¤ºï¼ˆæˆåŠŸ/å¤±è´¥/è¿›è¡Œä¸­/å·²æ’¤é”€ï¼‰

#### 8.10.11 å•æ“ä½œæ’¤é”€éªŒè¯

- [ ] å¯æ’¤é”€æ“ä½œçš„å¡ç‰‡æ­£ç¡®æ˜¾ç¤ºæ’¤é”€æŒ‰é’®
- [ ] ä¸å¯æ’¤é”€æ“ä½œçš„å¡ç‰‡ä¸æ˜¾ç¤ºæ’¤é”€æŒ‰é’®
- [ ] ç‚¹å‡»æ’¤é”€æŒ‰é’®æ­£ç¡®æ¢å¤æ–‡ä»¶åˆ°ä¿®æ”¹å‰çŠ¶æ€
- [ ] æ’¤é”€åæ“ä½œå¡ç‰‡çŠ¶æ€æ­£ç¡®æ›´æ–°ä¸º"å·²æ’¤é”€"
- [ ] æ’¤é”€åç¼–è¾‘å™¨æ­£ç¡®é‡æ–°åŠ è½½æ–‡ä»¶å†…å®¹
- [ ] å¤‡ä»½æ–‡ä»¶åœ¨æ’¤é”€åæ­£ç¡®åˆ é™¤
- [ ] è¶…è¿‡ 24 å°æ—¶çš„å¤‡ä»½æ–‡ä»¶æ­£ç¡®è‡ªåŠ¨æ¸…ç†
- [ ] å·²æ’¤é”€çš„æ“ä½œä¸èƒ½å†æ¬¡æ’¤é”€

#### 8.10.12 å…¨é‡å¿«ç…§æœºåˆ¶éªŒè¯

- [ ] `SnapshotService.create_snapshot_async()` æ­£ç¡®åˆ›å»ºé¡¹ç›®æ–‡ä»¶çš„å…¨é‡å‰¯æœ¬ï¼ˆå¼‚æ­¥æ‰§è¡Œï¼Œä¸é˜»å¡ UIï¼‰
- [ ] `SnapshotService.restore_snapshot_async()` æ­£ç¡®æ¢å¤é¡¹ç›®æ–‡ä»¶ï¼ˆå¼‚æ­¥æ‰§è¡Œï¼‰
- [ ] `SnapshotService.get_previous_snapshot()` æ­£ç¡®è¿”å›ä¸Šä¸€ä¸ªå¿«ç…§
- [ ] `SnapshotService.pop_snapshot()` æ­£ç¡®å¼¹å‡ºå¹¶åˆ é™¤æœ€æ–°å¿«ç…§
- [ ] å¿«ç…§å¿½ç•¥è§„åˆ™æ­£ç¡®ï¼ˆä¸æ‹·è´ `.circuit_ai/snapshots/`ã€`__pycache__/` ç­‰ï¼‰
- [ ] å¿«ç…§æ¢å¤åæ–‡ä»¶å†…å®¹æ­£ç¡®
- [ ] `cleanup_old_snapshots()` æ­£ç¡®æ¸…ç†è¶…å‡ºä¿ç•™æ•°é‡çš„æ—§å¿«ç…§
- [ ] å¿«ç…§ ID å‘½åè§„åˆ™æ­£ç¡®ï¼ˆ`iter_{count}_{timestamp}`ï¼‰
- [ ] 10 ä¸ªå¿«ç…§çš„ç£ç›˜å ç”¨åœ¨åˆç†èŒƒå›´å†…ï¼ˆ< 10MBï¼‰
- [ ] å¿«ç…§åˆ›å»º/æ¢å¤ä¸é˜»å¡ UI çº¿ç¨‹ï¼ˆå¯¹äº KB çº§æ–‡ä»¶åœ¨æ¯«ç§’çº§å®Œæˆï¼‰

#### 8.10.13 çº¿æ€§æ’¤å›æœºåˆ¶éªŒè¯

- [ ] æ’¤å›å‰é¢„æ£€æŸ¥æ­£ç¡®éªŒè¯ç›®æ ‡å¿«ç…§å­˜åœ¨
- [ ] æ’¤å›å‰é¢„æ£€æŸ¥æ­£ç¡®éªŒè¯ç£ç›˜ç©ºé—´
- [ ] æ’¤å›æ—¶æ­£ç¡®å†™å…¥æ¢å¤æ—¥å¿—ï¼ˆåŸå­å†™å…¥ï¼‰
- [ ] æ’¤å›æ—¶æ­£ç¡®æ¢å¤æ–‡ä»¶å¿«ç…§
- [ ] æ’¤å›åæ­£ç¡®é‡å»º GraphState
- [ ] æ’¤å›åæ­£ç¡®åˆ é™¤å½“å‰å¿«ç…§
- [ ] æ’¤å›åæ­£ç¡®åˆ é™¤æ¢å¤æ—¥å¿—
- [ ] ç¬¬ä¸€æ¬¡è¿­ä»£æ—¶æ’¤å›æŒ‰é’®æ­£ç¡®ç¦ç”¨æˆ–æ˜¾ç¤ºæç¤º
- [ ] æ’¤å›å UI æ­£ç¡®åˆ·æ–°

#### 8.10.14 å´©æºƒæ¢å¤æœºåˆ¶éªŒè¯

- [ ] `RecoveryLogService.write_log()` ä½¿ç”¨åŸå­å†™å…¥ï¼ˆå†™ä¸´æ—¶æ–‡ä»¶ + os.replaceï¼‰
- [ ] `RecoveryLogService.has_pending_recovery()` æ­£ç¡®æ£€æµ‹æœªå®Œæˆçš„æ¢å¤
- [ ] å¯åŠ¨æ—¶æ­£ç¡®æ£€æµ‹ `recovery.json` å­˜åœ¨
- [ ] `phase = "files_restored"` æ—¶é™é»˜å®ŒæˆçŠ¶æ€é‡å»º
- [ ] `phase = "started"` æ—¶å¼¹å‡ºå¯¹è¯æ¡†è®©ç”¨æˆ·é€‰æ‹©
- [ ] `phase = "state_rebuilt"` æ—¶é™é»˜åˆ é™¤æ¢å¤æ—¥å¿—
- [ ] æ¢å¤å®Œæˆåæ­£ç¡®åˆ é™¤æ¢å¤æ—¥å¿—
- [ ] æ¢å¤å¯¹è¯æ¡†æ­£ç¡®æ˜¾ç¤ºé€‰é¡¹
- [ ] ç”¨æˆ·é€‰æ‹©"ä»å¤‡ä»½æ¢å¤"åæ­£ç¡®æ‰§è¡Œ
- [ ] ç”¨æˆ·é€‰æ‹©"ä¿æŒç°çŠ¶"åæ­£ç¡®å¤„ç†

#### 8.10.15 å…¶ä»–éªŒè¯

- [ ] **LLM è¾“å‡ºè§£æå®¹é”™**ï¼šJSON æ ¼å¼é”™è¯¯æ—¶å°è¯•ä¿®å¤
- [ ] **å¿«ç…§åŸå­æ€§**ï¼šå¿«ç…§åˆ›å»ºä¸­é€”å¤±è´¥æ—¶æ­£ç¡®æ¸…ç†ä¸å®Œæ•´çš„å¿«ç…§ç›®å½•
- [ ] **EventBus å¼‚å¸¸éš”ç¦»**ï¼šå•ä¸ª handler å¼‚å¸¸ä¸å½±å“å…¶ä»–è®¢é˜…è€…

